/*
  OpenTok JavaScript Library v2.0.7.1
 http://www.tokbox.com/

 Copyright (c) 2011 TokBox, Inc.

 Date: July 02 10:33:10 2013
*/
(function(f){f.OT||(f.OT={});OT.properties={version:"v2.0.7.1",build:"03765d9",debug:"false",websiteURL:"http://www.tokbox.com",cdnURL:"http://static.opentok.com",loggingURL:"http://hlg.tokbox.com/prod",apiURL:"http://anvil.opentok.com",supportSSL:"true",cdnURLSSL:"https://swww.tokbox.com",loggingURLSSL:"https://hlg.tokbox.com/prod",apiURLSSL:"https://anvil.opentok.com"}})(window);
(function(){var f=this,d=f._,b={},a=Array.prototype,c=Object.prototype,e=a.push,h=a.slice,j=a.concat,i=c.toString,k=c.hasOwnProperty,n=a.forEach,m=a.map,o=a.reduce,q=a.reduceRight,p=a.filter,t=a.every,u=a.some,s=a.indexOf,z=a.lastIndexOf,c=Array.isArray,A=Object.keys,x=Function.prototype.bind,g=function(a){if(a instanceof g)return a;if(!(this instanceof g))return new g(a);this._wrapped=a};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=g),exports._=
g):f._=g;g.VERSION="1.4.4";var r=g.each=g.forEach=function(a,c,e){if(a!=null)if(n&&a.forEach===n)a.forEach(c,e);else if(a.length===+a.length)for(var D=0,d=a.length;D<d;D++){if(c.call(e,a[D],D,a)===b)break}else for(D in a)if(g.has(a,D)&&c.call(e,a[D],D,a)===b)break};g.map=g.collect=function(a,b,c){var e=[];if(a==null)return e;if(m&&a.map===m)return a.map(b,c);r(a,function(a,d,v){e[e.length]=b.call(c,a,d,v)});return e};g.reduce=g.foldl=g.inject=function(a,b,c,e){var d=arguments.length>2;a==null&&(a=
[]);if(o&&a.reduce===o){e&&(b=g.bind(b,e));return d?a.reduce(b,c):a.reduce(b)}r(a,function(a,v,h){if(d)c=b.call(e,c,a,v,h);else{c=a;d=true}});if(!d)throw new TypeError("Reduce of empty array with no initial value");return c};g.reduceRight=g.foldr=function(a,b,c,e){var d=arguments.length>2;a==null&&(a=[]);if(q&&a.reduceRight===q){e&&(b=g.bind(b,e));return d?a.reduceRight(b,c):a.reduceRight(b)}var h=a.length;if(h!==+h)var f=g.keys(a),h=f.length;r(a,function(k,i,g){i=f?f[--h]:--h;if(d)c=b.call(e,c,a[i],
i,g);else{c=a[i];d=true}});if(!d)throw new TypeError("Reduce of empty array with no initial value");return c};g.find=g.detect=function(a,b,c){var e;y(a,function(a,d,v){if(b.call(c,a,d,v)){e=a;return true}});return e};g.filter=g.select=function(a,b,c){var e=[];if(a==null)return e;if(p&&a.filter===p)return a.filter(b,c);r(a,function(a,d,v){b.call(c,a,d,v)&&(e[e.length]=a)});return e};g.reject=function(a,b,c){return g.filter(a,function(a,e,d){return!b.call(c,a,e,d)},c)};g.every=g.all=function(a,c,e){c||
(c=g.identity);var d=true;if(a==null)return d;if(t&&a.every===t)return a.every(c,e);r(a,function(a,v,h){if(!(d=d&&c.call(e,a,v,h)))return b});return!!d};var y=g.some=g.any=function(a,c,e){c||(c=g.identity);var d=false;if(a==null)return d;if(u&&a.some===u)return a.some(c,e);r(a,function(a,v,h){if(d||(d=c.call(e,a,v,h)))return b});return!!d};g.contains=g.include=function(a,b){return a==null?false:s&&a.indexOf===s?a.indexOf(b)!=-1:y(a,function(a){return a===b})};g.invoke=function(a,b){var c=h.call(arguments,
2),e=g.isFunction(b);return g.map(a,function(a){return(e?b:a[b]).apply(a,c)})};g.pluck=function(a,b){return g.map(a,function(a){return a[b]})};g.where=function(a,b,c){return g.isEmpty(b)?c?null:[]:g[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return false;return true})};g.findWhere=function(a,b){return g.where(a,b,true)};g.max=function(a,b,c){if(!b&&g.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&g.isEmpty(a))return-Infinity;var e={computed:-Infinity,
value:-Infinity};r(a,function(a,d,v){d=b?b.call(c,a,d,v):a;d>=e.computed&&(e={value:a,computed:d})});return e.value};g.min=function(a,b,c){if(!b&&g.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&g.isEmpty(a))return Infinity;var e={computed:Infinity,value:Infinity};r(a,function(a,d,v){d=b?b.call(c,a,d,v):a;d<e.computed&&(e={value:a,computed:d})});return e.value};g.shuffle=function(a){var b,c=0,e=[];r(a,function(a){b=g.random(c++);e[c-1]=e[b];e[b]=a});return e};var C=
function(a){return g.isFunction(a)?a:function(b){return b[a]}};g.sortBy=function(a,b,c){var e=C(b);return g.pluck(g.map(a,function(a,b,d){return{value:a,index:b,criteria:e.call(c,a,b,d)}}).sort(function(a,b){var c=a.criteria,e=b.criteria;if(c!==e){if(c>e||c===void 0)return 1;if(c<e||e===void 0)return-1}return a.index<b.index?-1:1}),"value")};var B=function(a,b,c,e){var d={},h=C(b||g.identity);r(a,function(b,f){var k=h.call(c,b,f,a);e(d,k,b)});return d};g.groupBy=function(a,b,c){return B(a,b,c,function(a,
b,c){(g.has(a,b)?a[b]:a[b]=[]).push(c)})};g.countBy=function(a,b,c){return B(a,b,c,function(a,b){g.has(a,b)||(a[b]=0);a[b]++})};g.sortedIndex=function(a,b,c,e){for(var c=c==null?g.identity:C(c),b=c.call(e,b),d=0,h=a.length;d<h;){var f=d+h>>>1;c.call(e,a[f])<b?d=f+1:h=f}return d};g.toArray=function(a){return!a?[]:g.isArray(a)?h.call(a):a.length===+a.length?g.map(a,g.identity):g.values(a)};g.size=function(a){return a==null?0:a.length===+a.length?a.length:g.keys(a).length};g.first=g.head=g.take=function(a,
b,c){return a==null?void 0:b!=null&&!c?h.call(a,0,b):a[0]};g.initial=function(a,b,c){return h.call(a,0,a.length-(b==null||c?1:b))};g.last=function(a,b,c){return a==null?void 0:b!=null&&!c?h.call(a,Math.max(a.length-b,0)):a[a.length-1]};g.rest=g.tail=g.drop=function(a,b,c){return h.call(a,b==null||c?1:b)};g.compact=function(a){return g.filter(a,g.identity)};var w=function(a,b,c){r(a,function(a){g.isArray(a)?b?e.apply(c,a):w(a,b,c):c.push(a)});return c};g.flatten=function(a,b){return w(a,b,[])};g.without=
function(a){return g.difference(a,h.call(arguments,1))};g.uniq=g.unique=function(a,b,c,e){if(g.isFunction(b)){e=c;c=b;b=false}var c=c?g.map(a,c,e):a,d=[],h=[];r(c,function(c,e){if(b?!e||h[h.length-1]!==c:!g.contains(h,c)){h.push(c);d.push(a[e])}});return d};g.union=function(){return g.uniq(j.apply(a,arguments))};g.intersection=function(a){var b=h.call(arguments,1);return g.filter(g.uniq(a),function(a){return g.every(b,function(b){return g.indexOf(b,a)>=0})})};g.difference=function(b){var c=j.apply(a,
h.call(arguments,1));return g.filter(b,function(a){return!g.contains(c,a)})};g.zip=function(){for(var a=h.call(arguments),b=g.max(g.pluck(a,"length")),c=Array(b),e=0;e<b;e++)c[e]=g.pluck(a,""+e);return c};g.object=function(a,b){if(a==null)return{};for(var c={},e=0,d=a.length;e<d;e++)b?c[a[e]]=b[e]:c[a[e][0]]=a[e][1];return c};g.indexOf=function(a,b,c){if(a==null)return-1;var e=0,d=a.length;if(c)if(typeof c=="number")e=c<0?Math.max(0,d+c):c;else{e=g.sortedIndex(a,b);return a[e]===b?e:-1}if(s&&a.indexOf===
s)return a.indexOf(b,c);for(;e<d;e++)if(a[e]===b)return e;return-1};g.lastIndexOf=function(a,b,c){if(a==null)return-1;var e=c!=null;if(z&&a.lastIndexOf===z)return e?a.lastIndexOf(b,c):a.lastIndexOf(b);for(c=e?c:a.length;c--;)if(a[c]===b)return c;return-1};g.range=function(a,b,c){if(arguments.length<=1){b=a||0;a=0}for(var c=arguments[2]||1,e=Math.max(Math.ceil((b-a)/c),0),d=0,h=Array(e);d<e;){h[d++]=a;a=a+c}return h};g.bind=function(a,b){if(a.bind===x&&x)return x.apply(a,h.call(arguments,1));var c=
h.call(arguments,2);return function(){return a.apply(b,c.concat(h.call(arguments)))}};g.partial=function(a){var b=h.call(arguments,1);return function(){return a.apply(this,b.concat(h.call(arguments)))}};g.bindAll=function(a){var b=h.call(arguments,1);b.length===0&&(b=g.functions(a));r(b,function(b){a[b]=g.bind(a[b],a)});return a};g.memoize=function(a,b){var c={};b||(b=g.identity);return function(){var e=b.apply(this,arguments);return g.has(c,e)?c[e]:c[e]=a.apply(this,arguments)}};g.delay=function(a,
b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)};g.defer=function(a){return g.delay.apply(g,[a,1].concat(h.call(arguments,1)))};g.throttle=function(a,b){var c,e,d,h,f=0,k=function(){f=new Date;d=null;h=a.apply(c,e)};return function(){var i=new Date,g=b-(i-f);c=this;e=arguments;if(g<=0){clearTimeout(d);d=null;f=i;h=a.apply(c,e)}else d||(d=setTimeout(k,g));return h}};g.debounce=function(a,b,c){var e,d;return function(){var h=this,f=arguments,k=c&&!e;clearTimeout(e);
e=setTimeout(function(){e=null;c||(d=a.apply(h,f))},b);k&&(d=a.apply(h,f));return d}};g.once=function(a){var b=false,c;return function(){if(b)return c;b=true;c=a.apply(this,arguments);a=null;return c}};g.wrap=function(a,b){return function(){var c=[a];e.apply(c,arguments);return b.apply(this,c)}};g.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}};g.after=function(a,b){return a<=0?b():function(){if(--a<1)return b.apply(this,
arguments)}};g.keys=A||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],c;for(c in a)g.has(a,c)&&(b[b.length]=c);return b};g.values=function(a){var b=[],c;for(c in a)g.has(a,c)&&b.push(a[c]);return b};g.pairs=function(a){var b=[],c;for(c in a)g.has(a,c)&&b.push([c,a[c]]);return b};g.invert=function(a){var b={},c;for(c in a)g.has(a,c)&&(b[a[c]]=c);return b};g.functions=g.methods=function(a){var b=[],c;for(c in a)g.isFunction(a[c])&&b.push(c);return b.sort()};g.extend=function(a){r(h.call(arguments,
1),function(b){if(b)for(var c in b)a[c]=b[c]});return a};g.pick=function(b){var c={},e=j.apply(a,h.call(arguments,1));r(e,function(a){a in b&&(c[a]=b[a])});return c};g.omit=function(b){var c={},e=j.apply(a,h.call(arguments,1)),d;for(d in b)g.contains(e,d)||(c[d]=b[d]);return c};g.defaults=function(a){r(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]==null&&(a[c]=b[c])});return a};g.clone=function(a){return!g.isObject(a)?a:g.isArray(a)?a.slice():g.extend({},a)};g.tap=function(a,b){b(a);return a};
var E=function(a,b,c,e){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a instanceof g)a=a._wrapped;if(b instanceof g)b=b._wrapped;var d=i.call(a);if(d!=i.call(b))return false;switch(d){case "[object String]":return a==""+b;case "[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case "[object Date]":case "[object Boolean]":return+a==+b;case "[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||
typeof b!="object")return false;for(var h=c.length;h--;)if(c[h]==a)return e[h]==b;c.push(a);e.push(b);var h=0,f=true;if(d=="[object Array]"){h=a.length;if(f=h==b.length)for(;h--;)if(!(f=E(a[h],b[h],c,e)))break}else{var d=a.constructor,k=b.constructor;if(d!==k&&(!g.isFunction(d)||!(d instanceof d&&g.isFunction(k)&&k instanceof k)))return false;for(var j in a)if(g.has(a,j)){h++;if(!(f=g.has(b,j)&&E(a[j],b[j],c,e)))break}if(f){for(j in b)if(g.has(b,j)&&!h--)break;f=!h}}c.pop();e.pop();return f};g.isEqual=
function(a,b){return E(a,b,[],[])};g.isEmpty=function(a){if(a==null)return true;if(g.isArray(a)||g.isString(a))return a.length===0;for(var b in a)if(g.has(a,b))return false;return true};g.isElement=function(a){return!!(a&&a.nodeType===1)};g.isArray=c||function(a){return i.call(a)=="[object Array]"};g.isObject=function(a){return a===Object(a)};r("Arguments Function String Number Date RegExp".split(" "),function(a){g["is"+a]=function(b){return i.call(b)=="[object "+a+"]"}});g.isArguments(arguments)||
(g.isArguments=function(a){return!(!a||!g.has(a,"callee"))});"function"!==typeof/./&&(g.isFunction=function(a){return typeof a==="function"});g.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))};g.isNaN=function(a){return g.isNumber(a)&&a!=+a};g.isBoolean=function(a){return a===true||a===false||i.call(a)=="[object Boolean]"};g.isNull=function(a){return a===null};g.isUndefined=function(a){return a===void 0};g.has=function(a,b){return k.call(a,b)};g.noConflict=function(){f._=d;return this};
g.identity=function(a){return a};g.times=function(a,b,c){for(var e=Array(a),d=0;d<a;d++)e[d]=b.call(c,d);return e};g.random=function(a,b){if(b==null){b=a;a=0}return a+Math.floor(Math.random()*(b-a+1))};var F={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};F.unescape=g.invert(F.escape);var J={escape:RegExp("["+g.keys(F.escape).join("")+"]","g"),unescape:RegExp("("+g.keys(F.unescape).join("|")+")","g")};g.each(["escape","unescape"],function(a){g[a]=function(b){return b==
null?"":(""+b).replace(J[a],function(b){return F[a][b]})}});g.result=function(a,b){if(a==null)return null;var c=a[b];return g.isFunction(c)?c.call(a):c};g.mixin=function(a){r(g.functions(a),function(b){var c=g[b]=a[b];g.prototype[b]=function(){var a=[this._wrapped];e.apply(a,arguments);a=c.apply(g,a);return this._chain?g(a).chain():a}})};var H=0;g.uniqueId=function(a){var b=++H+"";return a?a+b:b};g.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};
var G=/(.)^/,I={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},K=/\\|'|\r|\n|\t|\u2028|\u2029/g;g.template=function(a,b,c){var e,c=g.defaults({},c,g.templateSettings),d=RegExp([(c.escape||G).source,(c.interpolate||G).source,(c.evaluate||G).source].join("|")+"|$","g"),h=0,f="__p+='";a.replace(d,function(b,c,e,d,k){f=f+a.slice(h,k).replace(K,function(a){return"\\"+I[a]});c&&(f=f+("'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"));e&&(f=f+("'+\n((__t=("+e+"))==null?'':__t)+\n'"));
d&&(f=f+("';\n"+d+"\n__p+='"));h=k+b.length;return b});f=f+"';\n";c.variable||(f="with(obj||{}){\n"+f+"}\n");f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{e=new Function(c.variable||"obj","_",f)}catch(k){k.source=f;throw k;}if(b)return e(b,g);b=function(a){return e.call(this,a,g)};b.source="function("+(c.variable||"obj")+"){\n"+f+"}";return b};g.chain=function(a){return g(a).chain()};g.mixin(g);r("pop push reverse shift sort splice unshift".split(" "),
function(b){var c=a[b];g.prototype[b]=function(){var a=this._wrapped;c.apply(a,arguments);(b=="shift"||b=="splice")&&a.length===0&&delete a[0];return this._chain?g(a).chain():a}});r(["concat","join","slice"],function(b){var c=a[b];g.prototype[b]=function(){var a=c.apply(this._wrapped,arguments);return this._chain?g(a).chain():a}});g.extend(g.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}})}).call(this);
(function(){function f(a,b){var c=b||0,e=k;return e[a[c++]]+e[a[c++]]+e[a[c++]]+e[a[c++]]+"-"+e[a[c++]]+e[a[c++]]+"-"+e[a[c++]]+e[a[c++]]+"-"+e[a[c++]]+e[a[c++]]+"-"+e[a[c++]]+e[a[c++]]+e[a[c++]]+e[a[c++]]+e[a[c++]]+e[a[c++]]}function d(a,b,c){c=b&&c||0;"string"==typeof a&&(b="binary"==a?new i(16):null,a=null);a=a||{};a=a.random||(a.rng||j)();a[6]=a[6]&15|64;a[8]=a[8]&63|128;if(b)for(var e=0;16>e;e++)b[c+e]=a[e];return b||f(a)}var b=this,a,c,e=Array(16);a=function(){for(var a,b=0,b=0;16>b;b++)0===
(b&3)&&(a=4294967296*Math.random()),e[b]=a>>>((b&3)<<3)&255;return e};if(b.crypto&&crypto.getRandomValues){var h=new Uint32Array(4);c=function(){crypto.getRandomValues(h);for(var a=0;16>a;a++)e[a]=h[a>>2]>>>8*(a&3)&255;return e}}for(var j=c||a,i="function"==typeof Buffer?Buffer:Array,k=[],n={},m=0;256>m;m++)k[m]=(m+256).toString(16).substr(1),n[k[m]]=m;d.v4=d;d.parse=function(a,b,c){var e=b&&c||0,d=0,b=b||[];for(a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){16>d&&(b[e+d++]=n[a])});16>d;)b[e+
d++]=0;return b};d.unparse=f;d.BufferClass=i;d.mathRNG=a;d.whatwgRNG=c;var o=b.uuid;d.noConflict=function(){b.uuid=o;return d};b.uuid=d})();
!function(f){f.OT||(f.OT={});OT._=_.noConflict();OT.$=function(b){return document.getElementById(b)};OT.$.noop=function(){};OT.$.supportsWebSockets=function(){return"WebSocket"in f};OT.$.now=function(){var b=f.performance||{},a=b.now||b.mozNow||b.msNow||b.oNow||b.webkitNow;return a?a.bind(b):function(){return(new Date).getTime()}}();OT.$.browser=function(){var b=f.navigator.userAgent.toLowerCase(),a,c="Unknown";b.indexOf("firefox")>-1&&(c="Firefox");b.indexOf("opera")>-1?c="Opera":b.indexOf("msie")>
-1?c="IE":b.indexOf("chrome")>-1&&(c="Chrome");if((a=f.navigator.vendor)&&a.toLowerCase().indexOf("apple")>-1)c="Safari";b=null;OT.$.browser=function(){return c};return c};OT.$.deepClone=function(b){if(!OT._.isObject(b))return b;var a=OT._.isArray(b)?[]:{},c;for(c in b)b.hasOwnProperty(c)&&(a[c]=OT._.isObject(b[c])?this.deepClone(b[c]):b[c]);return a};OT.$.JSONify=f.JSON&&f.JSON.stringify?f.JSON.stringify:function(b){var a="{ ",c;for(c in b)a=typeof b[c]=="boolean"?a+('"'+c+'":'+b[c]+", "):a+('"'+
c+'":"'+b[c].toString()+'", ');return a=a.length>1?a.substring(0,a.length-2)+" }":"{}"};OT.$.canDefineProperty=!0;try{Object.defineProperty({},"x",{})}catch(d){OT.$.canDefineProperty=!1}Object.create||(Object.create=function(b){function a(){}if(arguments.length>1)throw Error("Object.create implementation only accepts the first parameter.");a.prototype=b;return new a})}(window);
(function(f){f.OT||(f.OT={});if(!OT.properties)throw Error("OT.properties does not exist, please ensure that you include a valid properties file.");var d=OT,b=OT.properties,a=OT._.clone(b);a.debug="true"===b.debug||!0===b.debug;a.supportSSL="true"===b.supportSSL||!0===b.supportSSL;a.supportSSL&&(0<=f.location.protocol.indexOf("https")||0<=f.location.protocol.indexOf("chrome-extension"))?(a.assetURL=a.cdnURLSSL+"/webrtc/"+a.version,a.loggingURL=a.loggingURLSSL,a.apiURL=a.apiURLSSL):a.assetURL=a.cdnURL+
"/webrtc/"+a.version;a.configURL=a.assetURL+"/js/dynamic_config.min.js";a.cssURL=a.assetURL+"/css/ot.min.css";d.properties=a})(window);
(function(f){var d=[];f.addEventListener("message",function(b){b.source==f&&"OT.$.zero-timeout"==b.data&&(b.stopPropagation(),0<d.length&&d.shift()())},!0);OT.$.callAsync=function(b){d.push(b);f.postMessage("OT.$.zero-timeout","*")};OT.$.createAsyncHandler=function(b){return function(){var a=Array.prototype.slice.call(arguments);OT.$.callAsync(function(){b.apply(null,a)})}}})(window);
(function(){OT.$.eventing=function(f){function d(a,b,e,d){if(a&&0!==a.length){var f=a.length;OT._.forEach(a,function(a){setTimeout(function(){try{a.apply(null,b)}finally{f--,0===f&&d&&d.apply(null,b.slice())}},1)})}}var b={};f.dispatchEvent=function(a,c){if(!a.type)throw OT.error("OT.Eventing.dispatchEvent: Event has no type"),OT.error(a),Error("OT.Eventing.dispatchEvent: Event has no type");a.target||(a.target=this);if(!b[a.type]||0===b[a.type].length){var e=[a];c&&c.apply(null,e.slice())}else return d(b[a.type],
[a],a.type,c),this};f.trigger=function(a){if(b[a]&&0!==b[a].length){var c=Array.prototype.slice.call(arguments);c.shift();d(b[a],c,a);return this}};f.on=function(a,b){if("string"===typeof a&&b)this.addEventListener(a,b);else for(var e in a)a.hasOwnProperty(e)&&this.addEventListener(e,a[e]);return this};f.off=function(a,c){if("string"===typeof a)c?this.removeEventListener(a,c):b[a]&&delete b[a];else if(a)for(var e in a)a.hasOwnProperty(e)&&this.removeEventListener(e,a[e]);else b={};return this};f.addEventListener=
function(a,c){b[a]||(b[a]=[]);b[a].push(c)};f.removeEventListener=function(a,c){b[a]&&(b[a]=OT._.without(b[a],c))};return f};OT.$.eventing(OT)})(window);
(function(){OT.Config=function(){var f=!1,d={},b={},a,c=document.head||document.getElementsByTagName("head")[0],e,h=function(){e&&(clearTimeout(e),e=null);a&&(a.onload=a.onreadystatechange=null,c&&a.parentNode&&c.removeChild(a),a=void 0)},j=function(){if(!a.readyState||/loaded|complete/.test(a.readyState))e&&(clearTimeout(e),e=null),f||i._onLoadTimeout()},i={loadTimeout:4E3,load:function(b){if(!b)throw Error("You must pass a valid configUrl to Config.load");f=!1;setTimeout(function(){a=document.createElement("script");
a.async="async";a.src=b;a.onload=a.onreadystatechange=OT._.bind(j,this);c.appendChild(a)},1);e=setTimeout(function(){i._onLoadTimeout()},this.loadTimeout)},_onLoadTimeout:function(){h();OT.warn("TB DynamicConfig failed to load in "+i.loadTimeout+" ms");this.trigger("dynamicConfigLoadFailed")},isLoaded:function(){return f},reset:function(){h();f=!1;d={};b={}},replaceWith:function(a){h();a||(a={});d=a.global||{};b=a.partners||{};f||(f=!0);this.trigger("dynamicConfigChanged")},get:function(a,c,e){a=
e&&b[e]&&b[e][a]?b[e][a]:d[a];return a?a[c]:null}};OT.$.eventing(i);return i}()})(window);
(function(f){function d(e,d,i){return function(){if(a>=d){var k=f.console;if(k&&k[e])if(k[e].apply||Function.prototype.bind)k[e].apply||(k[e]=Function.prototype.bind.call(k[e],k)),k[e].apply(k,arguments);else k[e](Array.prototype.slice.apply(arguments).join(" "));else i&&i.apply(OT,arguments);if(k=arguments){var n;try{n=OT.$.JSONify(k)}catch(m){n=k.toString()}2>=n.length||c.push([e,b(),n])}}}}function b(){var a=new Date;return a.toLocaleTimeString()+a.getMilliseconds()}OT.DEBUG=5;OT.LOG=4;OT.INFO=
3;OT.WARN=2;OT.ERROR=1;OT.NONE=0;var a=OT.NONE,c=[],e=!1;OT.log=d("log",OT.LOG);OT.debug=d("debug",OT.DEBUG,OT.log);OT.info=d("info",OT.INFO,OT.log);OT.warn=d("warn",OT.WARN,OT.log);OT.error=d("error",OT.ERROR,OT.log);OT.setLogLevel=function(b){a="number"===typeof b?b:0;a>=OT.DEBUG&&!e&&(OT.debug("OpenTok JavaScript library "+OT.properties.version),OT.debug("Release notes: "+OT.properties.websiteURL+"/opentok/webrtc/docs/js/release-notes.html"),OT.debug("Known issues: "+OT.properties.websiteURL+"/opentok/webrtc/docs/js/release-notes.html#knownIssues"),
e=!0);OT.debug("TB.setLogLevel("+a+")");return a};OT.getLogs=function(){return c};OT.setLogLevel(OT.properties.debug?OT.DEBUG:OT.ERROR)})(window);(function(){OT.$.castToBoolean=function(f,d){return void 0===f?d:"true"===f||!0===f};OT.$.roundFloat=function(f,d){return parseInt(Math.round(f*Math.pow(10,d)),10)/Math.pow(10,d)}})(window);
(function(){function f(d){for(var b in d)if(d.hasOwnProperty(b))return!0;return!1}OT.$.supportsClassList=function(){var d=typeof("undefined"!==document)&&"classList"in document.createElement("a");OT.$.supportsClassList=function(){return d};return d};OT.$.removeElement=function(d){d&&d.parentNode&&d.parentNode.removeChild(d)};OT.$.removeElementById=function(d){this.removeElement(OT.$(d))};OT.$.removeElementsByType=function(d,b){if(d)for(var a=d.getElementsByTagName(b);a.length;)d.removeChild(a[0])};
OT.$.emptyElement=function(d){for(;d.firstChild;)d.removeChild(d.firstChild);return d};OT.$.createElement=function(d,b,a){var d=document.createElement(d),c;for(c in b)if("object"===typeof b[c]){d[c]||(d[c]={});var e=b[c],f;for(f in e)d[c][f]=e[f]}else"className"===c?d.className=b[c]:d.setAttribute(c,b[c]);a&&(d.innerHTML=a);return d};OT.$.createButton=function(d,b,a){d=OT.$.createElement("button",b,d);if(a){for(var c in a)if(a.hasOwnProperty(c))OT.$.on(d,c,a[c]);d._boundEvents=a}return d};OT.$.on=
function(d,b,a){if(d.addEventListener)d.addEventListener(b,a,!1);else if(d.attachEvent)d.attachEvent("on"+b,a);else{var c=d["on"+b];d["on"+b]=function(){a.apply(this,arguments);c&&c.apply(this,arguments)}}};OT.$.off=function(d,b,a){d.removeEventListener?d.removeEventListener(b,a,!1):d.detachEvent&&d.detachEvent("on"+b,a)};OT.$.observeStyleChanges=function(d,b,a){var c={},e=function(a){switch(a){case "width":return OT.$.width(d);case "height":return OT.$.height(d);default:return OT.$.css(d)}};b.forEach(function(a){c[a]=
e(a)});observer=new MutationObserver(function(d){var j={};d.forEach(function(a){"style"===a.attributeName&&b.forEach(function(a){var b=e(a);b!==c[a]&&(j[a]=[c[a],b],c[a]=b)})});f(j)&&OT.$.callAsync(function(){a.call(null,j)})});observer.observe(d,{attributes:!0,attributeFilter:["style"],childList:!1,characterData:!1,subtree:!1});return observer};OT.$.observeNodeOrChildNodeRemoval=function(d,b){observer=new MutationObserver(function(a){var c=[];a.forEach(function(a){a.removedNodes.length&&(c=c.concat(Array.prototype.slice.call(a.removedNodes)))});
c.length&&OT.$.callAsync(function(){b(c)})});observer.observe(d,{attributes:!1,childList:!0,characterData:!1,subtree:!0});return observer}})(window);
(function(){OT.$.addClass=function(b,a){if(1===b.nodeType){var c=a.trim().split(/\s+/),e;if(OT.$.supportsClassList()){e=0;for(l=c.length;e<l;++e)b.classList.add(c[e])}else{if(!b.className&&1===c.length)b.className=a;else{var d=" "+b.className+" ";e=0;for(l=c.length;e<l;++e)~d.indexOf(" "+c[e]+" ")||(d+=c[e]+" ");b.className=d.trim()}return this}}};OT.$.removeClass=function(b,a){if(a&&1===b.nodeType){var c=a.trim().split(/\s+/),e;if(OT.$.supportsClassList()){e=0;for(l=c.length;e<l;++e)b.classList.remove(c[e])}else{var d=
(" "+b.className+" ").replace(/[\s+]/," ");e=0;for(l=c.length;e<l;++e)d=d.replace(" "+c[e]+" "," ");b.className=d.trim();return this}}};var f=function(b){return 0<b.offsetWidth?b.offsetWidth+"px":OT.$.css(b,"width")},d=function(b){return 0<b.offsetHeight?b.offsetHeight+"px":OT.$.css(b,"height")};OT.$.width=function(b,a){return a?(OT.$.css(b,"width",a),this):0===b.offsetWidth&&"none"===OT.$.css(b,"display")?OT.$.makeVisibleAndYield(b,function(){return f(b)}):f(b)};OT.$.height=function(b,a){return a?
(OT.$.css(b,"height",a),this):0===b.offsetHeight&&"none"===OT.$.css(b,"display")?OT.$.makeVisibleAndYield(b,function(){return d(b)}):d(b)};OT.$.centerElement=function(b,a,c){a||(a=parseInt(OT.$.width(b),10));c||(c=parseInt(OT.$.height(b),10));OT.$.css(b,"margin",-0.5*c+"px 0 0 "+(-0.5*a+"px"));OT.$.addClass(b,"OT_centered")}})(window);
(function(){var f={},d={};OT.$.isHidden=function(b){return"none"===b.ownerDocument.defaultView.getComputedStyle(b,null).getPropertyValue("display")};OT.$.show=function(b){var a=b.style.display;b.ownerDocument.defaultView.getComputedStyle(b,null).getPropertyValue("display");if(""===a||"none"===a)b.style.display=f[b]||"",delete f[b];if(OT.$.isHidden(b)){f[b]="none";a=b.style;if(d[b.ownerDocument]&&d[b.ownerDocument][b.nodeName])b=d[b.ownerDocument][b.nodeName];else{d[b.ownerDocument]||(d[b.ownerDocument]=
{});var c=b.ownerDocument.createElement(b.nodeName);b.ownerDocument.body.appendChild(c);b=d[b.ownerDocument][b.nodeName]=OT.$.css(c,"display");OT.$.removeElement(c)}a.display=b}return this};OT.$.hide=function(b){if("none"!==b.style.display)return f[b]=b.style.display,b.style.display="none",this};OT.$.css=function(b,a,c){if("string"!==typeof a){var b=b.style,e;for(e in a)b[e]=a[e];return this}if(c)return b.style[a]=c,this;a=a.replace(/([A-Z]|^ms)/g,"-$1").toLowerCase();e=b.ownerDocument.defaultView.getComputedStyle(b,
null).getPropertyValue(a);""===e&&(e=b.style[a]);return e};OT.$.applyCSS=function(b,a,c){var e={},d;for(d in a)a.hasOwnProperty(d)&&(e[d]=OT.$.css(b,d),OT.$.css(b,d,a[d]));c=c();for(d in a)a.hasOwnProperty(d)&&OT.$.css(b,d,e[d]);return c};OT.$.makeVisibleAndYield=function(b,a){return OT.$.applyCSS(b,{display:"block",visibility:"hidden"},a)}})(window);
(function(f){function d(b){Object.defineProperty(b.prototype,"firstElementChild",{get:function(){var a;for(a=this.firstChild;a&&1!=a.nodeType;)a=a.nextSibling;return a}});Object.defineProperty(b.prototype,"lastElementChild",{get:function(){var a;for(a=this.lastChild;a&&1!=a.nodeType;)a=a.previousSibling;return a}});Object.defineProperty(b.prototype,"nextElementSibling",{get:function(){for(var a=this;(a=a.nextSibling)&&1!=a.nodeType;);return a}});Object.defineProperty(b.prototype,"previousElementSibling",
{get:function(){for(var a=this;(a=a.previousSibling)&&1!=a.nodeType;);return a}})}OT.$.parseXML=function(b){var a;f.DOMParser?a=(new DOMParser).parseFromString(b,"text/xml"):(a=new ActiveXObject("Microsoft.XMLDOM"),a.async="false",a.loadXML(b),d(a));b=a.documentElement;return!b||!b.nodeName||"parsererror"===b.nodeName?null:a}})(window);
(function(){function f(b){if("string"===typeof b)return b;var a=[],c;for(c in b)a.push(encodeURIComponent(c)+"="+encodeURIComponent(b[c]));return a.join("&").replace(/\+/g,"%20")}OT.$.getXML=function(b,a){var c=a&&a.success,e=OT._.extend(a.headers||{},{"Content-Type":"application/xml"});OT.$.get(b,OT._.extend(a||{},{success:function(b){var e=b.target.responseXML,d;e?(d=e.documentElement,d=!d||!d.nodeName||"parsererror"===d.nodeName?!1:!0):d=!1;d?c&&c(e,b,b.target):a&&a.error&&a.error(b,b.target)},
headers:e}))};OT.$.getJSON=function(b,a){var c=a&&a.success;OT.$.get(b,OT._.extend(a||{},{success:function(b){var d;try{d=JSON.parse(b.target.responseText)}catch(f){a&&a.error&&a.error(b,b.target);return}c&&c(d,b,b.target)},headers:{"Content-Type":"application/json"}}))};OT.$.get=function(b,a){var c=new XMLHttpRequest,e=a||{};d(c,e.success,e.error);e.process&&c.addEventListener("progress",e.progress,!1);e.cancelled&&c.addEventListener("abort",e.cancelled,!1);c.open("GET",b,!0);e.headers||(e.headers=
{});for(var f in e.headers)c.setRequestHeader(f,e.headers[f]);c.send()};OT.$.post=function(b,a){var c=new XMLHttpRequest,e=a||{};d(c,e.success,e.error);e.process&&c.addEventListener("progress",e.progress,!1);e.cancelled&&c.addEventListener("abort",e.cancelled,!1);c.open("POST",b,!0);e.headers||(e.headers={});for(var h in e.headers)c.setRequestHeader(h,e.headers[h]);c.send(f(e.data))};OT.$.postFormData=function(b,a,c){if(!a)throw Error("OT.$.postFormData must be passed a data options.");var e=new FormData,
d;for(d in a)e.append(d,a[d]);OT.$.post(b,OT._.extend(c||{},{data:e}))};OT.$.getJSONP=function(b,a){var c,e=document.head||document.getElementsByTagName("head")[0],d,f=b,i=OT._.extend(a||{},{callbackParameter:"callback"}),k=function(){if((!c.readyState||/loaded|complete/.test(c.readyState))&&d)clearTimeout(d),d=null};i.callbackName="jsonp_callback_"+ +new Date;this.jsonp_callbacks[i.callbackName]=function(a){d&&(clearTimeout(d),d=null);c&&(c.onload=c.onreadystatechange=null,OT.$.removeElement(c),
c=void 0);i.success&&i.success(a)};f+=(/\?/.test(f)?"&":"?")+i.callbackParameter+"="+i.callbackName;c=OT.$.createElement("script",{async:"async",src:f,onload:k,onreadystatechange:k});e.appendChild(c);d=setTimeout(function(){_this._onLoadTimeout()},3E4)};var d=function(b,a,c){b.addEventListener("load",function(b){var d=b.target.status;200<=d&&300>d||304===d?a&&a.apply(null,arguments):c&&c(b)},!1);c&&b.addEventListener("error",c,!1)}})(window);
(function(){function f(a,b,e){b=b?parseInt(b,10):parseInt(OT.$.width(a.parentNode),10);e=e?parseInt(e,10):parseInt(OT.$.height(a.parentNode),10);if(!(0===b||0===e)){var b=(b+0)/e,f,j,i;d==b?f=e="100":b>d?(e="100",f=100*(b/d),i=(f-100)/2,j=0):(f="100",e=100*(d/b),j=(e-100)/2,i=0);OT.$.css(a,{width:e+"%",height:f+"%",marginLeft:"-"+j+"%",marginTop:"-"+i+"%"})}}var d=4/3,b=function(a){var b=OT.$(a);b?OT.$.emptyElement(b):(b=OT.$.createElement("div",{id:a}),b.style.backgroundColor="#000000",document.body.appendChild(b));
return b};OT.WidgetView=function(a,c){var e=b(a),d=document.createElement("div"),j,i,k,n=!0;c&&(width=c.width,height=c.height,width&&"number"==typeof width&&(width+="px"),height&&"number"==typeof height&&(height+="px"),e.style.width=width?width:"264px",e.style.height=height?height:"198px",e.style.overflow="hidden",(void 0===c.mirror||c.mirror)&&OT.$.addClass(e,"OT_mirrored"));c.classNames&&OT.$.addClass(e,c.classNames);OT.$.addClass(e,"OT_loading");OT.$.addClass(d,"OT_video-container");d.style.width=
e.style.width;d.style.height=e.style.height;e.appendChild(d);f(d,e.offsetWidth,e.offsetHeight);j=OT.$.observeStyleChanges(e,["width","height"],function(a){f(d,a.width?a.width[1]:e.offsetWidth,a.height?a.height[1]:e.offsetHeight)});k=OT.$.observeNodeOrChildNodeRemoval(e,function(a){if(i){if(OT._.some(a,function(a){return a===d||a.nodeName==="VIDEO"})){i.destroy();i=null}if(d){OT.$.removeElement(d);d=null}}});this.destroy=function(){if(j){j.disconnect();j=null}if(k){k.disconnect();k=null}if(i){i.destroy();
i=null}if(e){OT.$.removeElement(e);e=null}};Object.defineProperties(this,{poster:{get:function(){return i?i.poster:null},set:function(a){if(i)i.poster=a}},loading:{get:function(){return n},set:function(a){(n=a)?OT.$.addClass(e,"OT_loading"):OT.$.removeClass(e,"OT_loading")}},video:{get:function(){return i},set:function(a){i&&i.destroy();a.appendTo(d);i=a;f(d,e.offsetWidth,e.offsetHeight)}},domElement:{get:function(){return e}}});this.addError=function(a){e.innerHTML="<p>"+a+"<p>";OT.$.addClass(e,
"OT_subscriber_error")}}})(window);
(function(f){var d=function(){if(navigator.getUserMedia)return navigator.getUserMedia.bind(navigator);if(navigator.mozGetUserMedia)return navigator.mozGetUserMedia.bind(navigator);if(navigator.webkitGetUserMedia)return navigator.webkitGetUserMedia.bind(navigator)}();if(navigator.webkitGetUserMedia){if(webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks}),webkitMediaStream.prototype.getAudioTracks||(webkitMediaStream.prototype.getAudioTracks=
function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams}),!webkitRTCPeerConnection.prototype.getRemoteStreams)webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams}}else if(navigator.mozGetUserMedia&&(MediaStream.prototype.getVideoTracks||(MediaStream.prototype.getVideoTracks=function(){return[]}),!MediaStream.prototype.getAudioTracks))MediaStream.prototype.getAudioTracks=
function(){return[]};OT.$.supportsWebRTC=function(){var b=!1;if(navigator.webkitGetUserMedia)b="function"===typeof webkitRTCPeerConnection&&!!webkitRTCPeerConnection.prototype.addStream;else if(navigator.mozGetUserMedia){var a=f.navigator.userAgent.toLowerCase().match(/Firefox\/([0-9\.]+)/i);if(b="function"===typeof mozRTCPeerConnection&&null!==a&&20<parseFloat(a[1],10))try{new mozRTCPeerConnection,b=!0}catch(c){b=!1}}OT.$.supportsWebRTC=function(){return b};return b};OT.$.supportedCryptoScheme=function(){if(!OT.$.supportsWebRTC())return"NONE";
var b=f.navigator.userAgent.toLowerCase().match(/chrome\/([0-9\.]+)/i);return b&&25>parseFloat(b[1],10)?"SDES_SRTP":"DTLS_SRTP"};OT.$.getUserMedia=function(b,a,c,e,f){if(!b||OT._.all(b,function(a){return!1===a}))OT.error("Couldn't get UserMedia: All constraints were false"),c({code:"NO_CONSTRAINTS"});else{var j=null,i=function(){j=null;e&&e()},k=function(a){j?clearTimeout(j):f&&f();c.apply(null,arguments)};try{d(b,function(){j?clearTimeout(j):f&&f();a.apply(null,arguments)},k)}catch(n){OT.error("Couldn't get UserMedia: "+
n.toString()),k({})}-1===location.protocol.indexOf("https")?setTimeout(i,100):j=setTimeout(i,500)}}})(window);
(function(){OT.Modal=function(f,d){this.el=OT.$.createElement("section",{className:"OT_root OT_dialog OT_modal"},OT._.template("        <header>            <h1><%= title %></h1>        </header>        <div class='OT_dialog-body'>            <%= body %>        </div>    ",{title:f,body:d}));this.el.style.display="none";document.body.appendChild(this.el);OT.$.centerElement(this.el);OT.$.show(this.el);this.close=function(){OT.$.removeElement(this.el);this.el=null;return this}};OT.$.tbAlert=function(f,
d){var b=new OT.Modal(f,"<div>"+d+"</div>");OT.$.addClass(b.el,"OT_tbalert");var a=OT.$.createElement("input",{className:"OT_closeButton",type:"button",value:"close"});b.el.appendChild(a);a.onclick=function(){b&&b.close();b=null}}})(window);
(function(f){function d(a,b){var c=document.createElement("video");c.setAttribute("autoplay","");c.innerHTML=a;if(b){!0===b.muted&&(delete b.muted,c.muted="true");for(var d in b)c.setAttribute(d,b[d])}return c}function b(a,b,c,d){if(navigator.mozGetUserMedia||0<b.getVideoTracks().length&&b.getVideoTracks()[0].enabled){var k=setTimeout(OT._.bind(function(){0===a.currentTime?d("The video stream failed to connect. Please notify the site owner if this continues to happen."):(OT.warn("Never got the loadedmetadata event but currentTime > 0"),
c())},this),3E4);a.addEventListener("loadedmetadata",function(){clearTimeout(k);c()},!1)}else c();navigator.mozGetUserMedia?a.mozSrcObject=b:a.src=f.URL.createObjectURL(b);a.play()}OT.VideoOrientation={ROTATED_NORMAL:"OTVideoOrientationRotatedNormal",ROTATED_LEFT:"OTVideoOrientationRotatedLeft",ROTATED_RIGHT:"OTVideoOrientationRotatedRight",ROTATED_UPSIDE_DOWN:"OTVideoOrientationRotatedUpsideDown"};OT.VideoElement=function(a){var h,j,i,k=!1,a=OT._.defaults(a||{},{fallbackText:"Sorry, Web RTC is not available in your browser"});
OT.$.eventing(this);var n=OT._.bind(function(a){this.trigger("error",null,"There was an unexpected problem with the Video Stream: "+(c[parseInt(a.target.error.code,10)]||"An unknown error occurred."),this)},this),m=OT._.bind(function(){k=!0;this.trigger("streamBound",this)},this),o=OT._.bind(function(a){this.trigger("error",OT.ExceptionCodes.P2P_CONNECTION_FAILED,a,this)},this);j=d(a.fallbackText,a.attributes);j.addEventListener("error",n,!1);Object.defineProperties(this,{stream:{get:function(){return h}},
domElement:{get:function(){return j}},parentElement:{get:function(){return i}},isBoundToStream:{get:function(){return k}},poster:{get:function(){return j.getAttribute("poster")},set:function(a){j.setAttribute("poster",a)}}});this.appendTo=function(a){i=a;i.appendChild(j);return this};this.bindToStream=function(a){k=!1;h=a;b(j,h,m,o);return this};this.unbindStream=function(){if(!h)return this;j&&(navigator.mozGetUserMedia?j.mozSrcObject=null:f.URL.revokeObjectURL(j.src));h=null;return this};this.setAudioVolume=
function(a){j&&OT.$.roundFloat(j.volume=a/100,2)};this.getAudioVolume=function(){return j?parseInt(100*j.volume,10):50};this.destroy=function(){this.off();this.unbindStream();j&&(OT.$.removeElement(j),j=null);i=null}};OT.$.canDefineProperty&&Object.defineProperty(OT.VideoElement.prototype,"imgData",{get:function(){var a=OT.$.createElement("canvas",{width:this.domElement.videoWidth,height:this.domElement.videoHeight,style:{display:"none"}});document.body.appendChild(a);a.getContext("2d").drawImage(this.domElement,
0,0,a.width,a.height);var b=a.toDataURL("image/png");OT.$.removeElement(a);return b.replace("data:image/png;base64,","").trim()}});var a={OTVideoOrientationRotatedNormal:"rotate(0deg)",OTVideoOrientationRotatedLeft:"rotate(90deg)",OTVideoOrientationRotatedRight:"rotate(-90deg)",OTVideoOrientationRotatedUpsideDown:"rotate(180deg)"};OT.$.canDefineProperty&&Object.defineProperty(OT.VideoElement.prototype,"orientation",{set:function(b){b=a[b]||a.ROTATED_NORMAL;switch(OT.$.browser()){case "Chrome":case "Safari":this.domElement.style.webkitTransform=
b;break;case "IE":this.domElement.style.msTransform=b;break;default:this.domElement.style.transform=b}}});var c={};f.MediaError&&(c[f.MediaError.MEDIA_ERR_ABORTED]="The fetching process for the media resource was aborted by the user agent at the user's request.",c[f.MediaError.MEDIA_ERR_NETWORK]="A network error of some description caused the user agent to stop fetching the media resource, after the resource was established to be usable.",c[f.MediaError.MEDIA_ERR_DECODE]="An error of some description occurred while decoding the media resource, after the resource was established to be usable.",
c[f.MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED]="The media resource indicated by the src attribute was not suitable. ")})(window);
(function(f){var d=[],b=!1;OT.Analytics=function(){var a=OT.properties.loggingURL+"/logging/ClientEvent",c=OT.properties.loggingURL+"/logging/ClientQos",e={},h={payloadType:"payload_type",streamId:"stream_id",sessionId:"session_id",connectionId:"connection_id",widgetType:"widget_type",widgetId:"widget_id"},j=function(b,d,e,f){OT.$.post(d?c:a,{success:e,error:f,data:b,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},i=function(){if(!b&&0<d.length){b=!0;var a=d[0],c=function(){d.shift();
b=!1;i()};a&&j(a.data,a.isQos,function(){a.onComplete();setTimeout(c,50)},function(){OT.debug("Failed to send ClientEvent, moving on to the next item.");setTimeout(c,50)})}};this.logError=function(a,b,c,d,f){f||(f={});c=f.partnerId;if(!0===OT.Config.get("exceptionLogging","enabled",c)){var h;c?(h=[c,b,a].join("_"),h=100>=(e[h]||0)):h=!1;if(!h){var c=[c,b,a].join("_"),i=this.escapePayload(OT._.extend(d||{},{message:i,userAgent:navigator.userAgent}));e[c]="undefined"!==typeof e[c]?e[c]+1:1;return this.logEvent(OT._.extend(f,
{action:b+"."+a,payloadType:i[0],payload:i[1]}))}}};this.logEvent=function(a){var b=a.partnerId;a||(a={});var a=OT._.extend({variation:"",guid:a.connectionId||"",widget_id:"",session_id:"",connection_id:"",stream_id:"",partner_id:b,source:f.location.href,section:"",build:""},a),c;for(c in h)h.hasOwnProperty(c)&&a[c]&&(a[h[c]]=a[c],delete a[c]);d.push({data:a,onComplete:function(){},isQos:!1});i()};this.logQOS=function(a){var b=a.partnerId;a||(a={});var a=OT._.extend({guid:a.connectionId,widget_id:"",
session_id:"",connection_id:"",stream_id:"",partner_id:b,source:f.location.href,build:"",duration:0},a),c;for(c in h)h.hasOwnProperty(c)&&a[c]&&(a[h[c]]=a[c],delete a[c]);d.push({data:a,onComplete:function(){},isQos:!0});i()};this.escapePayload=function(a){var b=[],c=[],d;for(d in a)a.hasOwnProperty(d)&&(null!==a[d]&&void 0!==a[d])&&(b.push(a[d]?a[d].toString().replace("|","\\|"):""),c.push(d.toString().replace("|","\\|")));return[c.join("|"),b.join("|")]}}})(window);
(function(f){"file:"===location.protocol&&alert("You cannot test a page using WebRTC through the file system due to browser permissions. You must run it over a web server.");f.OT||(f.OT={});!f.URL&&f.webkitURL&&(f.URL=f.webkitURL);var d,b=document.location.hash;OT.initSession=function(a){this.sessions[a]||(this.sessions[a]=new OT.Session(a));return this.sessions[a]};OT.initPublisher=function(a,b,d){OT.debug("TB.initPublisher("+b+")");a=new OT.Publisher;a.publish(b,d);return a};OT.checkSystemRequirements=
function(){OT.debug("TB.checkSystemRequirements()");var a=OT.$.supportsWebSockets()&&OT.$.supportsWebRTC()?this.HAS_REQUIREMENTS:this.NOT_HAS_REQUIREMENTS;OT.checkSystemRequirements=function(){OT.debug("TB.checkSystemRequirements()");return a};return a};OT.upgradeSystemRequirements=function(){OT.onLoad(function(){for(var a=false,c=document.getElementsByTagName("meta"),e=0;e<c.length;e++){var f=c[e].httpEquiv,j=c[e].content;if(f&&f.toLowerCase()==="x-ua-compatible"&&j&&j.toLowerCase().indexOf("chrome=1")>
-1){a=true;break}}document.body.appendChild(function(){var b=document.createElement("iframe");b.id="_upgradeFlash";b.style.position="absolute";b.style.position="fixed";b.style.height="100%";b.style.width="100%";b.style.top="0px";b.style.left="0px";b.style.right="0px";b.style.bottom="0px";b.style.zIndex=1E3;try{b.style.backgroundColor="rgba(0,0,0,0.2)"}catch(c){b.style.backgroundColor="transparent";b.setAttribute("allowTransparency","true")}b.setAttribute("frameBorder","0");b.frameBorder="0";b.scrolling=
"no";b.setAttribute("scrolling","no");b.src=OT.properties.assetURL+"/html/upgradeFlash.html"+(a?"?cf=1":"")+"#"+encodeURIComponent(document.location.href);return b}());d&&clearInterval(d);d=setInterval(function(){var a=document.location.hash,c=/^#?\d+&/;if(a!==b&&c.test(a)){b=a;if(a.replace(c,"")==="close_window"){document.body.removeChild(document.getElementById("_upgradeFlash"));document.location.hash=""}else if(a.replace(c,"")==="installed_gcf"){document.location.hash="";document.location.href=
document.location.href.replace("#","")}}},100)})};OT.reportIssue=function(){OT.warn("ToDo: haven't yet implemented TB.reportIssue")};OT.$.moreInfoLink=function(a){var b=a?a.apiKey:OT.APIKEY,d=[OT.properties.websiteURL+"/opentok/info"];d[0]=d[0]+"?guid=a80c00ad22a3e7dcee262f5f7c549c94c794d663";if(a){d.push("session_id="+a.id);a.connected&&d.push("connection_id="+a.connection.id)}d.push("partner_id="+b);d.push("utm_source="+b);d.push("utm_medium="+OT.$.browser());OT.properties.assetURL.indexOf("static")>
-1?d.push("utm_campaign=static"):d.push("utm_campaign=staging");return d.join("&")};OT.components={};OT.sessions={};OT.rtc={};OT.APIKEY=function(){var a=document.getElementsByTagName("script"),a=a[a.length-1],a=a.getAttribute("src")||a.src;return(a=a.match(/[\?\&]apikey=([^&]+)/i))?a[1]:""}();OT.HAS_REQUIREMENTS=1;OT.NOT_HAS_REQUIREMENTS=0;f.OT||(f.OT=OT);f.TB||(f.TB=OT)})(window);
(function(){OT.Event=function(f,d){this.type=f;this.cancelable=void 0!==d?d:!0;var b=!1,a=null;this.preventDefault=function(){this.cancelable?b=!0:OT.warn("Event.preventDefault :: Trying to preventDefault on an Event that isn't cancelable")};this.isDefaultPrevented=function(){return b};OT.$.canDefineProperty&&Object.defineProperty(this,"target",{set:function(b){a=b},get:function(){return a}})};OT.Event.names={ACTIVE:"active",INACTIVE:"inactive",UNKNOWN:"unknown",PER_SESSION:"perSession",PER_STREAM:"perStream",
EXCEPTION:"exception",ISSUE_REPORTED:"issueReported",SESSION_CONNECTED:"sessionConnected",SESSION_DISCONNECTED:"sessionDisconnected",STREAM_CREATED:"streamCreated",STREAM_DESTROYED:"streamDestroyed",CONNECTION_CREATED:"connectionCreated",CONNECTION_DESTROYED:"connectionDestroyed",SIGNAL:"signal",STREAM_PROPERTY_CHANGED:"streamPropertyChanged",MICROPHONE_LEVEL_CHANGED:"microphoneLevelChanged",ARCHIVE_CREATED:"archiveCreated",ARCHIVE_CLOSED:"archiveClosed",ARCHIVE_LOADED:"archiveLoaded",ARCHIVE_SAVED:"archiveSaved",
SESSION_RECORDING_STARTED:"sessionRecordingStarted",SESSION_RECORDING_STOPPED:"sessionRecordingStopped",SESSION_RECORDING_IN_PROGRESS:"sessionRecordingInProgress",STREAM_RECORDING_IN_PROGRESS:"streamRecordingInProgress",SESSION_NOT_RECORDING:"sessionNotRecording",STREAM_NOT_RECORDING:"streamNotRecording",STREAM_RECORDING_STARTED:"streamRecordingStarted",STREAM_RECORDING_STOPPED:"streamRecordingStopped",PLAYBACK_STARTED:"playbackStarted",PLAYBACK_PAUSED:"playbackPaused",PLAYBACK_STOPPED:"playbackStopped",
RECORDING_STARTED:"recordingStarted",RECORDING_STOPPED:"recordingStopped",RESIZE:"resize",SETTINGS_BUTTON_CLICK:"settingsButtonClick",DEVICE_INACTIVE:"deviceInactive",INVALID_DEVICE_NAME:"invalidDeviceName",ACCESS_ALLOWED:"accessAllowed",ACCESS_DENIED:"accessDenied",ACCESS_DIALOG_OPENED:"accessDialogOpened",ACCESS_DIALOG_CLOSED:"accessDialogClosed",ECHO_CANCELLATION_MODE_CHANGED:"echoCancellationModeChanged",DEVICES_DETECTED:"devicesDetected",DEVICES_SELECTED:"devicesSelected",CLOSE_BUTTON_CLICK:"closeButtonClick",
MICLEVEL:"microphoneActivityLevel",MICGAINCHANGED:"microphoneGainChanged",ENV_LOADED:"envLoaded"};OT.ValueEvent=function(f,d){OT.Event.call(this,f);this.value=d};OT.ExceptionCodes={JS_EXCEPTION:2E3,AUTHENTICATION_ERROR:1004,INVALID_SESSION_ID:1005,CONNECT_FAILED:1006,CONNECT_REJECTED:1007,CONNECTION_TIMEOUT:1008,P2P_CONNECTION_FAILED:1013,API_RESPONSE_FAILURE:1014,UNABLE_TO_PUBLISH:1500,UNABLE_TO_SIGNAL:1510,UNABLE_TO_FORCE_DISCONNECT:1520,UNABLE_TO_FORCE_UNPUBLISH:1530};OT.ExceptionEvent=function(f,
d,b,a,c){OT.Event.call(this,f);this.message=d;this.title=b;this.code=a;this.component=c};OT.IssueReportedEvent=function(f,d){OT.Event.call(this,f);this.issueId=d};OT.EnvLoadedEvent=function(f){OT.Event.call(this,f)};OT.ConnectionEvent=function(f,d,b){OT.Event.call(this,f);this.connections=d;this.reason=b};OT.StreamEvent=function(f,d,b,a){OT.Event.call(this,f,a);this.streams=d;this.reason=b};OT.SessionConnectEvent=function(f,d,b,a){OT.Event.call(this,f);this.connections=d;this.streams=b;this.archives=
a;this.groups=[]};OT.SessionDisconnectEvent=function(f,d,b){OT.Event.call(this,f,b);this.reason=d};OT.VolumeEvent=function(f,d,b){OT.Event.call(this,f);this.streamId=d;this.volume=b};OT.DeviceEvent=function(f,d,b){OT.Event.call(this,f);this.camera=d;this.microphone=b};OT.DeviceStatusEvent=function(f,d,b,a,c){OT.Event.call(this,f);this.cameras=d;this.microphones=b;this.selectedCamera=a;this.selectedMicrophone=c};OT.ResizeEvent=function(f,d,b,a,c){OT.Event.call(this,f);this.widthFrom=d;this.widthTo=
b;this.heightFrom=a;this.heightTo=c};OT.StreamPropertyChangedEvent=function(f,d,b,a,c){OT.Event.call(this,f);this.type=f;this.stream=d;this.changedProperty=b;this.oldValue=a;this.newValue=c};OT.ArchiveEvent=function(f,d){OT.Event.call(this,f);this.archives=d};OT.ArchiveStreamEvent=function(f,d,b){OT.Event.call(this,f);this.archive=d;this.streams=b};OT.StateChangedEvent=function(f,d){OT.Event.call(this,f);this.changedValues=d};OT.ChangeFailedEvent=function(f,d,b,a){OT.Event.call(this,f);this.reasonCode=
d;this.reason=b;this.failedValues=a};OT.SignalEvent=function(f,d,b){OT.Event.call(this,f?"signal:"+f:OT.Event.names.SIGNAL,!1);this.data=d;this.from=b}})(window);
(function(){OT.WebSocketMessageType={CONNECTED_TO_WEBSOCKET_SERVER:1E3,CONNECT_TO_SESSION:1001,SIGNAL:1002,CONNECTION_CREATED:1003,CONNECTION_DESTROYED:1004,CONNECTION_COUNT_CHANGED:1005,STREAM_CREATED:1006,STREAM_MODIFIED:1007,STREAM_DESTROYED:1008,FORCE_DISCONNECT:1009,FORCE_UNPUBLISH:1010,JSEP_OFFER:1011,JSEP_ANSWER:1012,JSEP_PRANSWER:1013,JSEP_CANDIDATE:1014,JSEP_SUBSCRIBE:1015,JSEP_UNSUBSCRIBE:1016,WEBSOCKET_PING:1017,WEBSOCKET_PONG:1018,STREAM_REGISTERED:1019,SESSION_CONNECT_FAILED:1100,PUBLISH_FAILED:1101,
SUBSCRIBE_FAILED:1102,FORCEDISCONNECT_FAILED:1103,FORCEUNPUBLISH_FAILED:1104}})(window);
(function(){OT.WebSocketMessage=function(f,d){this.type=f;this.payload=d;this.toString=function(){return JSON.stringify(this)}};OT.WebSocketMessage.connectToSessionMessage=function(f,d,b,a,c){return{type:OT.WebSocketMessageType.CONNECT_TO_SESSION,payload:{sessionId:f,apiKey:d,token:b,supportsWebRTC:OT.$.supportsWebRTC(),connectionObjects:a,p2pEnabled:c}}};OT.WebSocketMessage.createStream=function(f,d,b,a,c,e,h,j){return{type:OT.WebSocketMessageType.STREAM_CREATED,payload:{publisherId:f,name:d,orientation:{videoOrientation:b,
width:a,height:c},hasAudio:e,hasVideo:h,p2pEnabled:j}}};OT.WebSocketMessage.modifyStream=function(f,d,b){return{type:OT.WebSocketMessageType.STREAM_MODIFIED,payload:{streamId:f,key:d,value:b}}};OT.WebSocketMessage.destroyStream=function(f){return{type:OT.WebSocketMessageType.STREAM_DESTROYED,payload:{streamId:f}}};OT.WebSocketMessage.jsepMessage=function(f,d,b,a){a.fromAddress=f;a.toAddresses=d;return{type:b,payload:a}};OT.WebSocketMessage.forceDisconnect=function(f){return{type:OT.WebSocketMessageType.FORCE_DISCONNECT,
payload:{connectionId:f}}};OT.WebSocketMessage.forceUnpublish=function(f){return{type:OT.WebSocketMessageType.FORCE_UNPUBLISH,payload:{streamId:f}}};OT.WebSocketMessage.pingMessage=function(f,d){return{type:OT.WebSocketMessageType.WEBSOCKET_PING,payload:{message:d,timestamp:(+Date.now()).toString()}}};OT.WebSocketMessage.pongMessage=function(f,d){return{type:OT.WebSocketMessageType.WEBSOCKET_PONG,payload:{message:f,timestamp:parseInt(d,10)}}};OT.WebSocketMessage.signalMessage=function(f,d,b){var a=
b||{},c=null;this.id=uuid();this.signal={};a.type&&(this.signal.type=a.type);a.data&&(this.signal.data=a.data);this.onSuccess=a.success&&OT._.isFunction(a.success)?OT.$.createAsyncHandler(a.success):null;this.onError=a.error&&OT._.isFunction(a.error)?OT.$.createAsyncHandler(a.error):null;var b=function(){if(a.hasOwnProperty("to")){if(a.to){if(a.to instanceof OT.Connection||a.to instanceof OT.Session)return null;if(OT._.isArray(a.to)){for(var b=0;b<a.to.length;b++)if(!(a.to[b]instanceof OT.Connection||
a.to[b]instanceof OT.Session))return{code:400,reason:"The To field was invalid"};return null}return{code:400,reason:"The To field was invalid"}}return{code:400,reason:"The To field was null or undefined. Either set it to a String value or omit it"}}return null},e=function(){var b=null;a.hasOwnProperty("type")&&(a.type?a.type.length>128?b={code:413,reason:"The signal type was too long, the maximum length of it is 128 characters"}:/^[a-zA-Z0-9\-\._~]+$/.exec(a.type)||(b={code:400,reason:"The signal type was invalid, it can only contain letters, numbers, '-', '_', and '~'."}):
b={code:400,reason:"The signal type was null or undefined. Either set it to a String value or omit it"});return b};this.toJson=function(){return c};this.error=function(){if(!a.hasOwnProperty("data"))return null;var b=null;if(a.data)try{JSON.stringify(a.data).length>8192&&(b={code:413,reason:"The data field was too long, the maximum size of it is 8192 characters"})}catch(c){b={code:400,reason:"The data field was not valid JSON"}}else b={code:400,reason:"The signal data was null or undefined. Either set it to a String value or omit it"};
return b}();this.error||(this.error=b());this.error||(this.error=e());if(this.valid=null===this.error)this.signal.to=a.to&&!OT._.isArray(a.to)?[a.to]:!a.to||0===a.to.length?[f]:a.to,f={id:this.id,toAddresses:OT._.map(this.signal.to,function(a){return typeof a==="string"?a:a.id}),fromAddress:d},a.type&&(f.type=a.type),a.data&&(f.data=JSON.stringify(a.data)),c=JSON.stringify({type:OT.WebSocketMessageType.SIGNAL,payload:f});a=null}})(window);
(function(f){function d(b,a,c){this.code=b;this.reason=a;this.signal=c}OT.Messenger=function(b,a){function c(){OT.debug("WebSocket connected");clearTimeout(s);s=setTimeout(function(){B("Failure","reason","Connection to the server timed out waiting to receive connected message.");w.trigger("exception","Connection to the server timed out waiting to receive connected message.",OT.ExceptionCodes.CONNECTION_TIMEOUT)},15E3)}function e(a){OT.debug("WebSocket error: "+a.data);w.trigger("exception","TB.Socket Error :: The socket to "+
b+" received an error: "+a.data,OT.ExceptionCodes.CONNECT_FAILED)}function h(){clearTimeout(z);w.trigger("ConnectionClosed",{reason:A?"clientDisconnected":"networkDisconnected"});y=null;r=!1}function j(a){OT.warn("WebSocket message recieved: "+a.data);i(a.data)}function i(b){var c=JSON.parse(b);switch(c.type){case OT.WebSocketMessageType.CONNECTED_TO_WEBSOCKET_SERVER:n(c.payload);break;case OT.WebSocketMessageType.WEBSOCKET_PONG:C=+Date.now();break;case OT.WebSocketMessageType.CONNECT_TO_SESSION:clearTimeout(s),
r=!0,y=c.payload.connectionId,k();default:if(m.hasOwnProperty(c.type)){var d=m[c.type].type;OT.debug("Received "+d);!r&&m[c.type].afterConnected?g.push(b):w.trigger(d,a.wrangle(c.payload))}else OT.debug("Message type "+c.type+" was not handled.");if(c.type===OT.WebSocketMessageType.CONNECT_TO_SESSION)for(;0<g.length;)i(g.shift())}}function k(){var a;a=C?+Date.now()-C>=q:!1;a?(OT.error("We seem to have lost connectivity!"),h()):(w.sendMessage(OT.WebSocketMessage.pingMessage(w.connectionId,"ping!")),
z=setTimeout(k,o))}function n(a){w.connectionId=a.connectionId;B("Success","webSocketServerUrl",_webSocketUrl,{connectionId:a.connectionId});clearTimeout(s);s=setTimeout(function(){B("Failure","reason","Connection to the server timed out waiting to receive connected message.");w.trigger("exception","Connection to the server timed out fetching the session state.",OT.ExceptionCodes.CONNECTION_TIMEOUT)},15E3);w.sendMessage(OT.WebSocketMessage.connectToSessionMessage(p,OT.APIKEY,t,u.requireConnectionObjects,
u.p2pEnabled))}var m={};m[OT.WebSocketMessageType.CONNECT_TO_SESSION]={type:"SessionConnected",afterConnected:!1};m[OT.WebSocketMessageType.SESSION_CONNECT_FAILED]={type:"SessionConnectFailed",afterConnected:!1};m[OT.WebSocketMessageType.CONNECTION_CREATED]={type:"ConnectionCreated",afterConnected:!0};m[OT.WebSocketMessageType.CONNECTION_DESTROYED]={type:"ConnectionDestroyed",afterConnected:!0};m[OT.WebSocketMessageType.STREAM_CREATED]={type:"StreamCreated",afterConnected:!0};m[OT.WebSocketMessageType.STREAM_MODIFIED]=
{type:"StreamModified",afterConnected:!0};m[OT.WebSocketMessageType.STREAM_DESTROYED]={type:"StreamDestroyed",afterConnected:!0};m[OT.WebSocketMessageType.STREAM_REGISTERED]={type:"StreamRegistered",afterConnected:!0};m[OT.WebSocketMessageType.JSEP_OFFER]={type:"JSEPMessageReceived",afterConnected:!0};m[OT.WebSocketMessageType.JSEP_ANSWER]={type:"JSEPMessageReceived",afterConnected:!0};m[OT.WebSocketMessageType.JSEP_PRANSWER]={type:"JSEPMessageReceived",afterConnected:!0};m[OT.WebSocketMessageType.JSEP_CANDIDATE]=
{type:"JSEPMessageReceived",afterConnected:!0};m[OT.WebSocketMessageType.JSEP_SUBSCRIBE]={type:"JSEPMessageReceived",afterConnected:!0};m[OT.WebSocketMessageType.JSEP_UNSUBSCRIBE]={type:"JSEPMessageReceived",afterConnected:!0};m[OT.WebSocketMessageType.SIGNAL]={type:"SignalReceived",afterConnected:!0};var o=25E3,q=3*o-100;OT.$.eventing(this);this.connectionId=this.webSocket=this.onConnectionClosed=this.onSessionConnected=null;var p,t,u,s,z,A=!1,x=new OT.Analytics,g=[],r=!1,y,C=null,B=function(a,b,
c,d){a={action:"webSocketConnection",variation:a,payload_type:b,payload:c,session_id:p,partner_id:u.partnerId,widget_id:u.widgetId,widget_type:"Controller"};d&&(a=OT._.extend(d,a));x.logEvent(a)};this.connect=function(a,d,g){p=a;t=d;u=g;_webSocketUrl="wss://"+b+":443/rumorwebsockets";B("Attempt","webSocketServerUrl|userAgent|sdkVersion|chromeFrame",[_webSocketUrl,navigator.userAgent,OT.properties.version,f.externalHost?"yes":"no"].map(function(a){return a.replace("|","\\|")}).join("|"));this.webSocket=
new WebSocket(_webSocketUrl);this.webSocket.onopen=c;this.webSocket.onclose=h;this.webSocket.onerror=e;this.webSocket.onmessage=j;s=setTimeout(function(){B("Failure","reason","Connection to the server timed out waiting to receive connected message.");w.trigger("exception","Connection to the server timed out.",OT.ExceptionCodes.CONNECTION_TIMEOUT)},15E3)};this.disconnect=function(){A=!0;this.webSocket&&(this.webSocket.close(),this.webSocket=null)};this.sendMessage=function(a){OT.warn("Sending WebSocket message: "+
JSON.stringify(a));this.webSocket.send(JSON.stringify(a))};this.signal=function(a){var b=new OT.WebSocketMessage.signalMessage(p,y,a),a=function(){if(b.onError)b.onError(new d(b.error.code,b.error.reason,b.signal))};if(b.valid){OT.warn("Sending WebSocket signal: "+b.toJson());try{if(this.webSocket.send(b.toJson()),b.onSuccess)b.onSuccess(b.signal)}catch(c){a()}}else a()};var w=this}})(window);
(function(){var f=new function(){var d=!1,b=!1,a=function(){b&&d&&OT.dispatchEvent(new OT.EnvLoadedEvent(OT.Event.names.ENV_LOADED))},c=function(){b=!0;OT.Config.load(OT.properties.configURL);a()},e=function(){d=!0;OT.Config.off("dynamicConfigChanged",e);OT.Config.off("dynamicConfigLoadFailed",f);a()},f=function(){e()};OT.Config.on("dynamicConfigChanged",e);OT.Config.on("dynamicConfigLoadFailed",f);"complete"==document.readyState||"interactive"==document.readyState&&document.body?c():document.addEventListener?
document.addEventListener("DOMContentLoaded",c,!1):document.attachEvent&&document.attachEvent("onreadystatechange",function(){"complete"==document.readyState&&c()});this.onLoad=function(a){if(b&&d)a();else OT.on(OT.Event.names.ENV_LOADED,a)}};OT.onLoad=function(d,b){if(b)f.onLoad(OT._.bind(d,b));else f.onLoad(d)}})(window);
(function(){function f(a,c,e,f){var j=d[e],f=f?OT._.clone(f):{};OT.error("TB.exception :: title: "+j+" ("+e+") msg: "+c);f.partnerId||(f.partnerId=OT.APIKEY);try{b||(b=new OT.Analytics),b.logError(e,"tb.exception",j,{details:c},f),OT.dispatchEvent(new OT.ExceptionEvent(OT.Event.names.EXCEPTION,c,j,e,a))}catch(i){OT.error("TB.exception :: Failed to dispatch exception - "+i.toString())}}var d={1E3:"Failed To Load",1004:"Authentication error",1005:"Invalid Session ID",1006:"Connect Failed",1007:"Connect Rejected",
1008:"Connect Time-out",1009:"Security Error",1010:"Not Connected",1011:"Invalid Parameter",1012:"Peer-to-peer Stream Play Failed",1013:"Peer-to-peer Connection Failed",1014:"API Response Failure",1500:"Unable to Publish",1510:"Unable to Signal",1520:"Unable to Force Disconnect",1530:"Unable to Force Unpublish",1540:"Unable to record archive",1550:"Unable to play back archive",1560:"Unable to create archive",1570:"Unable to load archive",2E3:"Internal Error",2001:"Embed Failed",3E3:"Archive load exception",
3001:"Archive create exception",3002:"Playback stop exception",3003:"Playback start exception",3004:"Record start exception",3005:"Record stop exception",3006:"Archive load exception",3007:"Session recording in progress",3008:"Archive recording internal failure",4E3:"WebSocket Connection Failed",4001:"WebSocket Network Disconnected"},b;OT.handleJsException=function(a,b,d){d&&!d.target&&(d.target=null);var h,j=d.session;j?(h={sessionId:j.sessionId},j.connected&&(h.connectionId=j.connection.connectionId)):
d.sessionId&&(h={sessionId:d.sessionId});f(d.target,a,b,h)};OT.exceptionHandler=function(a,b,d,h,j){var i;a&&((i=OT.components[a])||OT.warn("Could not find the component with component ID "+a));f(i,b,h,j)}})(window);(function(){OT.ConnectionCapabilities=function(f){f.supportsWebRTC=OT.$.castToBoolean(f.supportsWebRTC);this.supportsWebRTC=f.supportsWebRTC}})(window);
(function(){OT.Connection=function(f,d,b,a){this.id=this.connectionId=f;this.creationTime=Number(d);this.data=b;this.capabilities=new OT.ConnectionCapabilities(a);this.quality=null;OT.$.eventing(this)}})(window);
(function(){OT.Stream=function(f,d,b,a,c,e,h,j,i,k,n,m,o,q){this.id=this.streamId=f;this.sessionId=k;this.connection=d;this.name=b;this.data=a;this.type=c||"basic";this.creationTime=Number(e);this.hasAudio=OT.$.castToBoolean(h,!0);this.hasVideo=OT.$.castToBoolean(j,!0);this.orientation=i;this.peerId=n;this.quality=m;this.videoDimensions={width:o,height:q};OT.$.eventing(this);this.update=function(a,b){switch(a){case "hasAudio":case "hasVideo":this[a]=OT.$.castToBoolean(b,!0);break;case "quality":case "name":case "videoDimensions":case "orientation":this[a]=
b}};this.startRecording=function(){OT.debug("OT.Stream.startRecording");throw Error("OT.Stream.startRecording: Is not implemented yet.");};this.stopRecording=function(){OT.debug("OT.Stream.stopRecording");throw Error("OT.Stream.stopRecording: Is not implemented yet.");}}})(window);
(function(){OT.DOMComponentCleanup=function(){var f={},d={},b=function(b){OT.$.on(b,"unload",function(){return a(b)})},a=function(a){d[a]&&0!==d[a].length&&(d[a].slice().forEach(function(a){a.destroy()}),delete d[a])};return{add:function(a){if(a.targetElement&&a.id){var e=a.targetElement.ownerDocument.defaultView;f[a.id]=e;d.hasOwnProperty(e)||(d[e]=[],b(e));d[e].push(a)}},remove:function(a){if(a.id&&f[a.id]){var b=f[a.id],h;-1!=(h=OT._.indexOf(d[b],a))&&d[b].splice(h,1)}}}}()})(window);
(function(f){var d=f.webkitRTCPeerConnection||f.mozRTCPeerConnection,b=f.mozRTCSessionDescription||f.RTCSessionDescription,a=f.mozRTCIceCandidate||f.RTCIceCandidate,c=function(a){return function(b){OT.debug("IceCandidateForwarder: Ice Candidate");b.candidate?a(OT.WebSocketMessageType.JSEP_CANDIDATE,{candidate:b.candidate}):OT.debug("IceCandidateForwarder: No more ICE candidates. PeerConnection Status: "+b.srcElement.readyState+", Ice Status: "+b.srcElement.iceState)}},e=function(){var b=[],c=null;
Object.defineProperty(this,"peerConnection",{set:function(a){c=a}});this.process=function(d){d=new a(d.candidate);c?c.addIceCandidate(d):b.push(d)};this.processPending=function(){for(;b.length;)c.addIceCandidate(b.shift())}},h=function(a,b,c,d){var e=function(a){return function(b){d&&d(a,b)}},f=function(b){a.setLocalDescription(b,function(){c(b)},e("Error while setting LocalDescription"))};-1===b.sdp.indexOf("a=crypto")&&(b.sdp=b.sdp.replace(/^c=IN(.*)$/gmi,"c=IN$1\r\na=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:FakeFakeFakeFakeFakeFakeFakeFakeFakeFake\\r\\n"));
a.setRemoteDescription(b,function(){a.createAnswer(f,e("Error while setting createAnswer"),null,false)},e("Error while setting RemoteDescription"))},j=function(a,b,c){var d={mandatory:{},optional:[]},e=function(a){return function(b){c&&c(a,b)}};navigator.mozGetUserMedia&&(d.mandatory.MozDontOfferDataChannel=!0);a.createOffer(function(c){a.setLocalDescription(c,function(){b(c)},e("Error while setting LocalDescription"))},e("Error while creating Offer"),d)};OT.PeerConnection=function(a){var f,n=new e,
m,o,q="new",p=[];OT.$.eventing(this);a.iceServers||(a.iceServers=[]);var t;if(0<a.iceServers.length&&(t=navigator.userAgent.match(/(Firefox)\/([0-9]+\.[0-9]+)/)))a.iceServers=23>parseFloat(t[2],10)?a.iceServers.map(function(a){return{url:a.url.replace("turn:","stun:")}}):a.iceServers.map(function(a){if(a.url.trim().substr(0,5)!=="turn:")return a;var b=a.url.trim().split(/[:@]/);return{username:b[1],credential:a.credential,url:b[0]+":"+b[2]}});var u=OT._.bind(function(a,b){if(p.length)p[0](a,b)},this),
s=OT._.bind(function(){if(!f){try{OT.debug('Creating peer connection config "'+JSON.stringify(a)+'".');f=new d(a,{optional:[{DtlsSrtpKeyAgreement:true}]})}catch(b){OT.error("Failed to create PeerConnection, exception: "+b.message);return null}n.peerConnection=f;f.onicecandidate=c(u);f.onaddstream=OT._.bind(A,this);f.onremovestream=OT._.bind(x,this);if(f.onsignalingstatechange!==void 0)f.onsignalingstatechange=OT._.bind(z,this);else if(f.onstatechange!==void 0)f.onstatechange=OT._.bind(z,this)}return f},
this),z=function(a){if((a=a.target.signalingState||a.target.readyState)&&a.toLowerCase()!==q){q=a.toLowerCase();OT.debug("PeerConnection.stateChange: "+q);switch(q){case "closed":if(n)n.peerConnection=null;f=null;this.trigger("close")}}},A=function(a){this.trigger("streamAdded",a.stream,a.type==="audio"||a.type==="video"?a.type:"merged")},x=function(a){this.trigger("streamRemoved",a.stream,a.type==="audio"||a.type==="video"?a.type:"merged")},g=function(a){a=new b(a.sdp);s();_remoteDescriptionType=
a.type;_remoteDescription=a;h(f,a,function(a){u(OT.WebSocketMessageType.JSEP_ANSWER,{sdp:a})},function(a,b){y("PeerConnection.offerProcessor "+a+": "+b)})},r=function(){OT.debug("PeerConnection.processSubscribe: Sending offer to subscriber.");s();j(f,function(a){m=a;u(OT.WebSocketMessageType.JSEP_OFFER,{sdp:m})},function(a,b){y("PeerConnection.suscribeProcessor "+a+": "+b)})},y=OT._.bind(function(a){OT.error(a);this.trigger("error",a)},this);this.addLocalStream=function(a){s();f.addStream(a)};this.disconnect=
function(){n=null;if(f){var a=f.signalingState||f.readyState;a&&a.toLowerCase()!=="closed"&&f.close();f=null}this.off()};this.processMessage=function(a,c){OT.debug("PeerConnection.processMessage: Received "+a+" from "+c.fromAddress);OT.debug(c);switch(a){case OT.WebSocketMessageType.JSEP_SUBSCRIBE:r.call(this,c);break;case OT.WebSocketMessageType.JSEP_OFFER:g.call(this,c);break;case OT.WebSocketMessageType.JSEP_ANSWER:if(c.sdp){o=new b(c.sdp);_remoteDescriptionType=o.type;_remoteDescription=o;f.setRemoteDescription(o);
n.processPending()}else OT.error("PeerConnection.processMessage: Weird message, no SDP.");break;case OT.WebSocketMessageType.JSEP_CANDIDATE:n.process(c);break;default:OT.debug("PeerConnection.processMessage: Received an unexpected message of type "+a+" from "+c.fromAddress+": "+JSON.stringify(c))}return this};this.registerMessageDelegate=function(a){p.push(a)};this.unregisterMessageDelegate=function(a){OT._.without(p,a)};Object.defineProperty(this,"remoteStreams",{get:function(){var a;if(f){if(f.getRemoteStreams)a=
f.getRemoteStreams();else if(f.remoteStreams)a=f.remoteStreams;else throw Error("Invalid Peer Connection object implements no method for retrieving remote streams");a=Array.prototype.slice.call(a)}else a=[];return a}})}})(window);(function(){var f={};OT.PeerConnections={add:function(d,b,a){d=d.id+"_"+b.id;(b=f[d])||(b=f[d]={count:0,pc:new OT.PeerConnection(a)});b.count+=1;return b.pc},remove:function(d,b){var a=d.id+"_"+b.id,c=f[a];c&&(c.count-=1,0===c.count&&(c.pc.disconnect(),delete f[a]))}}})(window);
(function(){OT.PublisherPeerConnection=function(f,d,b,a){var c,e=!1,h=OT._.bind(function(a,c){if(!e){if(a===OT.WebSocketMessageType.JSEP_CANDIDATE||a===OT.WebSocketMessageType.JSEP_OFFER||a===OT.WebSocketMessageType.JSEP_ANSWER)e=-1!==(a===OT.WebSocketMessageType.JSEP_CANDIDATE?c.candidate.candidate:c.sdp.sdp).indexOf("typ relay");a===OT.WebSocketMessageType.JSEP_OFFER&&this.trigger("connected")}d.sendJSEPMessage(f,a,OT._.extend(c,{streamId:b.id}))},this);OT.$.eventing(this);this.destroy=function(){c&&
OT.PeerConnections.remove(f,b);c=null;this.off()};this.processMessage=function(a,b){c.processMessage(a,b)};c=OT.PeerConnections.add(f,b,{iceServers:d.sessionInfo.iceServers?d.sessionInfo.iceServers:[{url:"stun:stun.l.google.com:19302"}]});c.on({close:OT._.bind(function(){this.destroy();this.trigger("disconnected",this)},this),error:OT._.bind(function(a){this.trigger("error",null,a,this);this.destroy()},this)});c.registerMessageDelegate(h);c.addLocalStream(a);Object.defineProperty(this,"remoteConnection",
{value:f});Object.defineProperty(this,"hasRelayCandidates",{get:function(){return e}})}})(window);
(function(){OT.SubscriberPeerConnection=function(f,d,b){var a,c={},e=!1,h=function(a,b){c[b]=a;this.trigger("remoteStreamAdded",c[b],b,this)},j=OT._.bind(function(a,c){if(!e&&(a===OT.WebSocketMessageType.JSEP_CANDIDATE||a===OT.WebSocketMessageType.JSEP_OFFER||a===OT.WebSocketMessageType.JSEP_ANSWER))e=-1!==(a===OT.WebSocketMessageType.JSEP_CANDIDATE?c.candidate.candidate:c.sdp.sdp).indexOf("typ relay");a===OT.WebSocketMessageType.JSEP_ANSWER&&this.trigger("connected");d.sendJSEPMessage(f,a,OT._.extend(c,
{streamId:b.id}))},this),i=function(b){var c="get"+(b?"Video":"Audio")+"Tracks";return function(b){var d=a.remoteStreams,e;if(0!==d.length&&d[0][c])for(var f=0,h=d.length;f<h;++f){e=d[f];e=e[c]();for(var i=0,k=e.length;i<k;++i)e[i].enabled=b}}};OT.$.eventing(this);this.destroy=function(){d&&(d.connected&&b)&&d.sendJSEPMessage(b.connection,OT.WebSocketMessageType.JSEP_UNSUBSCRIBE,{streamId:b.id});a&&(this.subscribeToAudio(!1),OT.PeerConnections.remove(f,b));c={};a=null;this.off()};this.processMessage=
function(b,c){a.processMessage(b,c)};this.subscribeToAudio=i(!1);this.subscribeToVideo=i(!0);Object.defineProperty(this,"hasRelayCandidates",{get:function(){return e}});a=OT.PeerConnections.add(f,b,{iceServers:d.sessionInfo.iceServers?d.sessionInfo.iceServers:[{url:"stun:stun.l.google.com:19302"}]});a.on({close:OT._.bind(function(){this.destroy();this.trigger("disconnected",this)},this),streamAdded:OT._.bind(h,this),streamRemoved:OT._.bind(function(a,b){delete c[b];this.trigger("remoteStreamRemoved",
a,b,this)},this),error:OT._.bind(function(a){this.trigger("error",null,a,this)},this)});a.registerMessageDelegate(j);0<a.remoteStreams.length?a.remoteStreams.forEach(h,this):d.sendJSEPMessage(f,OT.WebSocketMessageType.JSEP_SUBSCRIBE,{streamId:b.id,keyManagemenMethod:OT.$.supportedCryptoScheme()})}})(window);
(function(){OT.Chrome=function(f){var d={},b=function(a,b){b.parent=this;b.appendTo(f.parent);d[a]=b;Object.defineProperty(this,a,{get:function(){return d[a]}})};f.parent&&(OT.$.eventing(this),this.destroy=function(){this.off();this.hide();for(var a in d)d[a].destroy()},this.show=function(){for(var a in d)d[a].show()},this.hide=function(){for(var a in d)d[a].hide()},this.set=function(a,c){if("string"===typeof a&&c)b.call(this,a,c);else for(var d in a)a.hasOwnProperty(d)&&b.call(this,d,a[d]);return this})}})(window);
(function(){OT.Chrome.Behaviour||(OT.Chrome.Behaviour={});OT.Chrome.Behaviour.Widget=function(f,d){var b=d||{},a,c;f.setDisplayMode=function(b){b=b||"auto";if(a!==b){OT.$.removeClass(this.domElement,"OT_mode-"+a);OT.$.addClass(this.domElement,"OT_mode-"+b);c=a;a=b}};f.show=function(){this.setDisplayMode(c);if(b.onShow)b.onShow();return this};f.hide=function(){this.setDisplayMode("off");if(b.onHide)b.onHide();return this};f.destroy=function(){if(b.onDestroy)b.onDestroy(this.domElement);this.domElement&&
OT.$.removeElement(this.domElement);return f};f.appendTo=function(a){this.domElement=OT.$.createElement(b.nodeName||"div",b.htmlAttributes,b.htmlContent);if(b.onCreate)b.onCreate(this.domElement);f.setDisplayMode("on");a.appendChild(this.domElement);setTimeout(function(){f.setDisplayMode(b.mode)},2E3);return f}}})(window);
(function(){OT.Chrome.NamePanel=function(f){var d=f.name;if(!d||""===d.trim().length)d=null,f.mode="off";var b;this.__defineGetter__("domElement",function(){return b});this.__defineSetter__("domElement",function(a){b=a});OT.Chrome.Behaviour.Widget(this,{mode:f.mode,nodeName:"h1",htmlContent:d,htmlAttributes:{className:"OT_name"}});this.__defineSetter__("name",OT._.bind(function(a){d||this.setDisplayMode("auto");d=a;b.innerHTML=d},this))}})(window);
(function(){OT.Chrome.MuteButton=function(f){var d,b=f.muted||!1,a;this.__defineGetter__("domElement",function(){return a});this.__defineSetter__("domElement",function(b){a=b});var c=function(){(b=!b)?(OT.$.addClass(a,"OT_active"),this.parent.trigger("muted",this)):(OT.$.removeClass(a,"OT_active"),this.parent.trigger("unmuted",this));return!1};OT.Chrome.Behaviour.Widget(this,{mode:f.mode,nodeName:"button",htmlContent:"Mute",htmlAttributes:{className:b?"OT_mute OT_active":"OT_mute"},onCreate:OT._.bind(function(a){d=
OT._.bind(c,this);a.addEventListener("click",d,!1)},this),onDestroy:OT._.bind(function(a){d=null;a.removeEventListener("click",d,!1)},this)})}})(window);
(function(){OT.Chrome.MicVolume=function(f){var d,b=f.muted||!1,a;this.__defineGetter__("domElement",function(){return a});this.__defineSetter__("domElement",function(b){a=b});var c=function(){(b=!b)?(OT.$.addClass(a,"active"),this.parent.trigger("muted",this)):(OT.$.removeClass(a,"active"),this.parent.trigger("unmuted",this));return!1};OT.Chrome.Behaviour.Widget(this,{mode:f.mode,nodeName:"button",htmlContent:"Mute",htmlAttributes:{className:"OT_mic-volume"},onCreate:OT._.bind(function(a){d=OT._.bind(c,
this);a.addEventListener("click",d,!1)},this),onDestroy:OT._.bind(function(a){d=null;a.removeEventListener("click",d,!1)},this)})}})(window);
(function(){OT.Chrome.SettingsPanelButton=function(f){var d,b=function(){this.parent.trigger("SettingsPanel:open",this);return!1},a;this.__defineGetter__("domElement",function(){return a});this.__defineSetter__("domElement",function(b){a=b});OT.Chrome.Behaviour.Widget(this,{mode:f.mode,nodeName:"button",htmlContent:"Settings",htmlAttributes:{className:"OT_settings-panel"},onCreate:OT._.bind(function(a){d=OT._.bind(b,this);a.addEventListener("click",d,!1)},this),onDestroy:OT._.bind(function(a){d=null;
a.removeEventListener("click",d,!1)},this)})}})(window);
(function(){OT.Chrome.SettingsPanel=function(f){if(f.stream){var d=f.stream,b;this.__defineGetter__("domElement",function(){return b});this.__defineSetter__("domElement",function(a){b=a});var a=function(){var a=d.getVideoTracks().length?d.getVideoTracks()[0].label:"None",f=d.getAudioTracks().length?d.getAudioTracks()[0].label:"None";b.innerHTML="<dl>                                        <dt>Cam</dt>                                        <dd>"+a+"</dd>                                        <dt>Mic</dt>                                        <dd>"+
f+"</dd>                                    </dl>";a=OT.$.createButton("Close",{className:"OT_close"},{click:OT._.bind(c,this)});b.appendChild(a)},c=function(){this.parent.trigger("SettingsPanel:close",this);return!1};OT.Chrome.Behaviour.Widget(this,{mode:f.mode,nodeName:"section",htmlContent:"Settings",htmlAttributes:{className:"OT_settings-panel"},onCreate:OT._.bind(a,this),onShow:OT._.bind(function(){a.call(this)},this)})}}})(window);
(function(){OT.Chrome.OpenTokButton=function(f){if(!f||!f.infoHref)return!1;var d;this.__defineGetter__("domElement",function(){return d});this.__defineSetter__("domElement",function(b){d=b});OT.Chrome.Behaviour.Widget(this,{mode:f?f.mode:null,nodeName:"a",htmlContent:"OpenTok",htmlAttributes:{className:"OT_opentok",title:"more info",href:f.infoHref,target:"_blank"}});this.__defineSetter__("infoHref",function(b){f.infoHref=b;d.setAttribute("href",b)})}})(window);
(function(){OT.StylableComponent=function(d,b){if(!d.trigger)throw Error("OT.StylableComponent is dependent on the mixin OT.$.eventing. Ensure that this is included in the object before StylableComponent.");var a=new f(b,function(a,b,f){f?d.trigger("styleValueChanged",a,b,f):d.trigger("styleValueChanged",a,b)});d.getStyle=function(b){return a.get(b)};d.setStyle=function(b,d,f){"string"!==typeof b?a.setAll(b,f):a.set(b,d);return this}};var f=function(d,b){var a="showMicButton showSpeakerButton showSettingsButton showCameraToggleButton nameDisplayMode buttonDisplayMode showSaveButton showRecordButton showRecordStopButton showReRecordButton showPauseButton showPlayButton showPlayStopButton showStopButton backgroundImageURI showControlPanel showRecordCounter showPlayCounter showControlBar showPreviewTime".split(" "),
c={buttonDisplayMode:["auto","off","on"],nameDisplayMode:["auto","off","on"],showSettingsButton:[!0,!1],showMicButton:[!0,!1],showCameraToggleButton:[!0,!1],showSaveButton:[!0,!1],backgroundImageURI:null,showControlBar:[!0,!1],showPlayCounter:[!0,!1],showRecordCounter:[!0,!1],showPreviewTime:[!0,!1]},e={},f=function(a,b){return"backgroundImageURI"===a||c.hasOwnProperty(a)&&OT._.include(c[a],b)},j=function(a){switch(a){case "true":return!0;case "false":return!1;default:return a}};this.getAll=function(){var b=
OT._.clone(e),c;for(c in b)0>a.indexOf(c)&&delete b[c];return b};this.get=function(a){return a?e[a]:this.getAll()};this.setAll=function(a,c){var d,m,o;for(o in a)m=j(a[o]),f(o,m)?(d=e[o],m!==d&&(e[o]=m,c||b(o,m,d))):OT.warn("Style.setAll::Invalid style property passed "+o+" : "+m);return this};this.set=function(a,c){OT.debug("Publisher.setStyle: "+a.toString());var d=j(c),m;if(!f(a,d))return OT.warn("Style.set::Invalid style property passed "+a+" : "+d),this;m=e[a];d!==m&&(e[a]=d,b(a,c,m));return this};
d&&this.setAll(d,!0)}})(window);(function(){OT.Microphone=function(f,d){var b,a=50;Object.defineProperty(this,"muted",{get:function(){return b},set:function(a){if(b!==a){b=a;for(var a=f.getAudioTracks(),d=0,h=a.length;d<h;++d)a[d].enabled=!b}}});Object.defineProperty(this,"gain",{get:function(){return a},set:function(b){OT.warn("OT.Microphone.gain IS NOT YET IMPLEMENTED");a=b}});this.muted=void 0!==d?!0===d:f.getAudioTracks().length?!f.getAudioTracks()[0].enabled:!1}})(window);
(function(){OT.Publisher=function(){if(OT.checkSystemRequirements()){var f=OT.Publisher.nextId(),d,b,a,c,e,h,j={},i=!1,k,n,m,o,q=new OT.Analytics,p;OT.$.eventing(this);OT.StylableComponent(this,{showMicButton:!0,showSettingsButton:!0,showCameraToggleButton:!0,nameDisplayMode:"auto",buttonDisplayMode:"auto",backgroundImageURI:null});var t=function(a,b,d,e){q.logEvent({action:a,variation:b,payload_type:d,payload:e,session_id:h?h.sessionId:null,connection_id:h&&h.connected?h.connection.connectionId:
null,partner_id:h?h.apiKey:OT.APIKEY,streamId:c?c.id:null,widget_id:f,widget_type:"Publisher"})},u=function(){OT.debug("OT.Publisher.onLoaded");t("publish","Success","streamType","WebRTC");b.loading=!1;E.call(this);i=!0;this.trigger("loaded",this)},s=function(a){t("publish","Failure","reason","Publisher PeerConnection Error: "+a);OT.handleJsException("Publisher PeerConnection Error: "+a,OT.ExceptionCodes.P2P_CONNECTION_FAILED,{session:h,target:this})},z=function(c){OT.debug("OT.Publisher.onStreamAvailable");
this.dispatchEvent(new OT.Event(OT.Event.names.ACCESS_ALLOWED,!1));e&&(e.stop(),e=null);e=c;m=new OT.Microphone(e,!k.publishAudio);this.publishVideo(k.publishVideo);a=new OT.VideoElement({attributes:{muted:!0}});a.on({streamBound:OT._.bind(u,this),timeout:OT._.bind(s,this),error:OT._.bind(r,this)}).bindToStream(e);b.video=a;OT.DOMComponentCleanup.add(this,a)},A=function(a){var c=function(a,b){OT.error("OT.Publisher.onStreamAvailableError "+a);t("publish","Failure","reason","Publisher failed to access camera/mic: "+
a);OT.handleJsException("Publisher failed to access camera/mic: "+a,2E3,{session:h,target:b})};switch(a.code){case 1:OT.error("OT.Publisher.onStreamAvailableError Permission Denied");t("publish","Failure","reason","Publisher Access Denied: Permission Denied ("+a.code+")");var d=new OT.Event(OT.Event.names.ACCESS_DENIED);this.dispatchEvent(d,function(){!d.isDefaultPrevented()&&b&&b.destroy()});break;case "NO_CONSTRAINTS":b&&b.destroy();c("No constaints were provided",this);break;default:b&&b.destroy(),
c("Unknown Reason ("+a.code+")",this)}},x=function(){t("accessDialog","Opened","","");this.dispatchEvent(new OT.Event(OT.Event.names.ACCESS_DIALOG_OPENED,!1))},g=function(){t("accessDialog","Closed","","");this.dispatchEvent(new OT.Event(OT.Event.names.ACCESS_DIALOG_CLOSED,!1))},r=function(a,b){OT.error("OT.Publisher.onVideoError");var c=b+(a?" ("+a+")":"");t("stream",null,"reason","Publisher while playing stream: "+c);OT.handleJsException("Publisher error playing stream: "+c,2E3,{session:h,target:this})},
y=function(a){OT.debug("OT.Subscriber has been disconnected from the Publisher's PeerConnection");this.cleanupSubscriber(a.remoteConnection.id)},C=function(a,b,c){t("publish","Failure","reason|hasRelayCandidates",["Publisher PeerConnection with connection "+c.remoteConnection.id+" failed: "+b,c.hasRelayCandidates].join("|"));OT.handleJsException("Publisher PeerConnection Error: "+b,2E3,{session:h,target:this});delete j[c.remoteConnection.id]},B=function(a){var b=j[a.id];if(!b){var d=OT.$.now();t("createPeerConnection",
"Attempt","","");b=j[a.id]=new OT.PublisherPeerConnection(a,h,c,e);b.on({connected:function(){t("createPeerConnection","Success","pcc|hasRelayCandidates",[parseInt(OT.$.now()-d,10),b.hasRelayCandidates].join("|"))},disconnected:OT._.bind(y,this),error:OT._.bind(C,this)})}return b},w=function(a){if(!1===a)return"off";a=this.getStyle("buttonDisplayMode");return!1===a?"on":a},E=function(){o=(new OT.Chrome({parent:b.domElement})).set({name:new OT.Chrome.NamePanel({name:k.name,mode:this.getStyle("nameDisplayMode")}),
muteButton:new OT.Chrome.MuteButton({muted:!1===k.publishAudio,mode:w.call(this,this.getStyle("showMicButton"))}),opentokButton:new OT.Chrome.OpenTokButton({infoHref:OT.$.moreInfoLink(h)})}).on({muted:OT._.bind(function(){this.publishAudio(!1)},this),unmuted:OT._.bind(function(){this.publishAudio(!0)},this)})};this.publish=function(a,c){OT.debug("OT.Publisher: publish");d&&this.unpublish();d=a||uuid();k=OT._.defaults(c||{},{publishAudio:!0,publishVideo:!0,mirror:!0});k.style&&this.setStyle(k.style,
null,!0);k.name&&(k.name=k.name.toString());k.classNames="OT_root OT_publisher";OT.onLoad(function(){b=new OT.WidgetView(d,k);OT.$.getUserMedia({audio:true,video:true},OT._.bind(z,this),OT._.bind(A,this),OT._.bind(x,this),OT._.bind(g,this))},this);return this};this.publishAudio=function(a){k.publishAudio=a;m.muted=!a;h&&c&&h.sendMessage(OT.WebSocketMessage.modifyStream(c.streamId,"hasAudio",a))};this.publishVideo=function(a){var b=k.publishVideo;k.publishVideo=a;h&&(c&&k.publishVideo!==b)&&h.sendMessage(OT.WebSocketMessage.modifyStream(c.streamId,
"hasVideo",a));for(var b=e.getVideoTracks(),d=0,f=b.length;d<f;++d)b[d].enabled=a};this.recordQOS=function(){q.logQOS({widget_type:"Publisher",stream_type:"WebRTC",sessionId:h?h.sessionId:null,connectionId:h&&h.connected?h.connection.connectionId:null,partnerId:h?h.apiKey:OT.APIKEY,streamId:c?c.id:null,widgetId:f,version:OT.properties.version,media_server_name:h.sessionInfo.messagingServer,duration:(new Date).getTime()-n.getTime()})};this.destroy=function(){OT.DOMComponentCleanup.remove(this);o&&
(o.destroy(),o=null);this.disconnect();m=null;a&&(a.destroy(),a=null);e&&(e.stop(),e=null);b&&(b.destroy(),b=null);this.session&&this._.unpublishFromSession(this.session);p&&clearInterval(p);c=d=null;i=!1;_properties=h=null;this.trigger("destroyed",this);this.off();return this};this.disconnect=function(){for(var a in j)this.cleanupSubscriber(a)};this.cleanupSubscriber=function(a){var b=j[a];b&&(b.destroy(),delete j[a],t("disconnect","PeerConnection","subscriberConnection",a))};this.processMessage=
function(a,b,c){OT.debug("OT.Publisher.processMessage: Received "+a+" from "+b.id);OT.debug(c);switch(a){case OT.WebSocketMessageType.JSEP_UNSUBSCRIBE:this.cleanupSubscriber(b.id);break;default:B.call(this,b).processMessage(a,c)}};this.getImgData=function(){return!i?(OT.error("OT.Publisher.getImgData: Cannot getImgData before the Publisher is publishing."),null):a.imgData};this._={publishToSession:OT._.bind(function(a){this.session=a;o&&(o.opentokButton.infoHref=OT.$.moreInfoLink(h));var b=function(){this.session&&
a.sendMessage(OT.WebSocketMessage.createStream(this.guid,k&&k.name?k.name:"",OT.VideoOrientation.ROTATED_NORMAL,640,480,k.publishAudio,k.publishVideo,this.session.sessionInfo.p2pEnabled))};if(i)b.call(this);else this.on("loaded",OT._.bind(b,this));t("publish","Attempt","streamType","WebRTC");return this},this),unpublishFromSession:OT._.bind(function(a){if(!this.session||a.id!==this.session.id)return OT.warn("The publisher "+this.guid+" is trying to unpublish from a session "+a.id+" it is not attached to"),
this;a.connected&&this.stream&&a.sendMessage(OT.WebSocketMessage.destroyStream(this.stream.id));this.disconnect();this.session=null;t("unpublish","Success","sessionId",a.id);return this},this),publishedToSessionHandler:OT._.bind(function(){n=new Date;p=setInterval(this.recordQOS,3E4)},this)};this.detectDevices=function(){OT.warn("Fixme: Haven't implemented detectDevices")};this.detectMicActivity=function(){OT.warn("Fixme: Haven't implemented detectMicActivity")};this.getEchoCancellationMode=function(){OT.warn("Fixme: Haven't implemented getEchoCancellationMode");
return"fullDuplex"};this.setMicrophoneGain=function(){OT.warn("Fixme: Haven't implemented setMicrophoneGain")};this.getMicrophoneGain=function(){OT.warn("Fixme: Haven't implemented getMicrophoneGain");return 0.5};this.setCamera=function(){OT.warn("Fixme: Haven't implemented setCamera")};this.setMicrophone=function(){OT.warn("Fixme: Haven't implemented setMicrophone")};this.on("styleValueChanged",OT._.bind(function(a,b){if(o)switch(a){case "nameDisplayMode":o.name.setDisplayMode(b)}},this));this.__defineGetter__("id",
function(){return d});this.__defineGetter__("guid",function(){return f});this.__defineGetter__("stream",function(){return c});this.__defineSetter__("stream",function(a){c=a});this.__defineGetter__("streamId",function(){return!c?null:c.id});this.__defineGetter__("targetElement",function(){return a.domElement});this.__defineGetter__("domId",function(){return d});this.__defineGetter__("session",function(){return h});this.__defineSetter__("session",function(a){h=a});this.__defineGetter__("isWebRTC",function(){return!0});
Object.defineProperty(this._,"webRtcStream",{get:function(){return e}})}else OT.upgradeSystemRequirements()};OT.Publisher.nextId=uuid})(window);
(function(){OT.Subscriber=function(f,d){var b=uuid(),a=f||b,c,e={},h,j,i,k=d.session,n=!1,m,o,q,p=OT._.clone(d),t=new OT.Analytics,u=50;if(k){OT.$.eventing(this);OT.StylableComponent(this,{nameDisplayMode:"auto",buttonDisplayMode:"auto",backgroundImageURI:null});var s=function(a,c,d,e){t.logEvent({action:a,variation:c,payload_type:d,payload:e,stream_id:j?j.id:null,session_id:k?k.sessionId:null,connection_id:k&&k.connected?k.connection.connectionId:null,partner_id:k&&k.connected?k.sessionInfo.partnerId:
null,widget_id:b,widget_type:"Subscriber"})},z=function(){n||0===e.length||(OT.debug("OT.Subscriber.onLoaded"),n=!0,m=OT.$.now(),s("createPeerConnection","Success","pcc|hasRelayCandidates",[parseInt(m-o,10),i&&i.hasRelayCandidates].join("|")),q=setInterval(this.recordQOS,3E4),c.loading=!1,y.call(this),this.trigger("loaded",this),s("subscribe","Success","streamId",j.id))},A=function(){OT.debug("OT.Subscriber has been disconnected from the Publisher's PeerConnection");this.disconnect()},x=function(a,
b){n||s("createPeerConnection","Failure","reason|hasRelayCandidates",["Subscriber PeerConnection Error: "+b,i&&i.hasRelayCandidates].join("|"));this.disconnect();s("subscribe","Failure","reason","Subscriber PeerConnection Error: "+b);OT.handleJsException("Subscriber PeerConnection Error: "+b,OT.ExceptionCodes.P2P_CONNECTION_FAILED,{session:k,target:this});c&&c.addError(b)},g=function(a,b){OT.debug("OT.Subscriber.onRemoteStreamAdded");this.subscribeToAudio(p.subscribeToAudio);this.subscribeToVideo(p.subscribeToVideo);
var d=new OT.VideoElement;d.setAudioVolume(u);d.on({streamBound:OT._.bind(z,this),timeout:OT._.bind(x,this),error:OT._.bind(x,this)});"audio"===b&&OT.$.addClass(d.domElement,"OT_hidden-audio");d.bindToStream(a);c.video=d;OT.DOMComponentCleanup.add(this,d);e[b]=d;"audio"!==b&&this.streamOrientationDidChange(j.orientation.width,j.orientation.height,j.orientation.videoOrientation);s("createPeerConnection","StreamAdded","","");this.trigger("streamAdded",this)},r=function(a){OT.debug("OT.Subscriber.onStreamRemoved");
for(var b in e)e[b].stream==a&&(e[b].destroy(),delete e[b]);this.trigger("streamRemoved",this)},y=function(){h=(new OT.Chrome({parent:c.domElement})).set({name:new OT.Chrome.NamePanel({name:p.name,mode:this.getStyle("nameDisplayMode")}),opentokButton:new OT.Chrome.OpenTokButton({infoHref:OT.$.moreInfoLink(k)})}).on({muted:function(){},unmuted:function(){}})};this.recordQOS=function(){n&&(k&&k.connected)&&t.logQOS({widget_type:"Subscriber",stream_type:"WebRTC",session_id:k.sessionId,connectionId:k.connection.connectionId,
media_server_name:k.sessionInfo.messagingServer,partner_id:k.apiKey,stream_id:j.id,widget_id:b,version:OT.properties.version,duration:parseInt(OT.$.now()-m,10)})};this.subscribe=function(b){OT.debug("OT.Subscriber: subscribe to "+b.id);if(n)return OT.error("OT.Subscriber.Subscribe: Cannot subscribe, already subscribing."),!1;if(!b)return OT.error("OT.Subscriber: No stream parameter."),!1;if(j)return OT.error("OT.Subscriber: Already subscribed"),!1;j=b;a=f||uuid();p.name=j.name;p.classNames="OT_root OT_subscriber";
p.style&&this.setStyle(p.style,null,!0);p.audioVolume&&this.setAudioVolume(p.audioVolume);p.subscribeToAudio=OT.$.castToBoolean(p.subscribeToAudio,!0);p.subscribeToVideo=OT.$.castToBoolean(p.subscribeToVideo,!0);c=new OT.WidgetView(a,p);o=OT.$.now();j.connection.id!==k.connection.id?(s("createPeerConnection","Attempt","",""),i=new OT.SubscriberPeerConnection(j.connection,k,j),i.on({disconnected:OT._.bind(A,this),error:OT._.bind(x,this),remoteStreamAdded:OT._.bind(g,this),remoteStreamRemoved:OT._.bind(r,
this)})):g.call(this,k.getPublisherForStream(j)._.webRtcStream,"merged");s("subscribe","Attempt","streamId",j.id);return this};this.destroy=function(){OT.DOMComponentCleanup.remove(this);this.disconnect();h&&(h.destroy(),h=null);c&&(c.destroy(),c=null);j&&s("unsubscribe",null,"streamId",j.id);j=a=null;clearInterval(q);p=k=null;this.trigger("destroyed",this);this.off();return this};this.disconnect=function(){n=!1;for(var a in e)e[a].destroy();e={};i&&(i.destroy(),i=null,s("disconnect","PeerConnection",
"streamId",j.id))};this.processMessage=function(a,b,c){OT.debug("OT.Subscriber.processMessage: Received "+a+" message from "+b.id);OT.debug(c);i&&i.processMessage(a,c)};this.getImgData=function(){return!this.subscribing?(OT.error("OT.Subscriber.getImgData: Cannot getImgData before the Subscriber is subscribing."),null):(e.merged||e.video).imgData};this.setAudioVolume=function(a){a=parseInt(a,10);if(!a)return OT.error("OT.Subscriber.setAudioVolume: value should be an integer between 0 and 100"),this;
u=Math.max(0,Math.min(100,a));u!=a&&OT.warn("OT.Subscriber.setAudioVolume: value should be an integer between 0 and 100");if(e.merged||e.audio)(e.merged||e.audio).setAudioVolume(u);return this};this.getAudioVolume=function(){return e.merged||e.audio?(e.merged||e.audio).getAudioVolume():u};this.subscribeToAudio=function(a){p.subscribeToAudio=OT.$.castToBoolean(a,!0);i&&i.subscribeToAudio(a)};this.subscribeToVideo=function(a){p.subscribeToVideo=OT.$.castToBoolean(a,!0);i&&i.subscribeToVideo(a)};this.streamOrientationDidChange=
function(a,b,c){(e.merged||e.video).orientation=c};this.on("styleValueChanged",OT._.bind(function(a,b){if(h)switch(a){case "nameDisplayMode":h.name.setDisplayMode(b)}},this));this.__defineGetter__("id",function(){return a});this.__defineGetter__("stream",function(){return j});this.__defineGetter__("targetElement",function(){return e.merged||e.video?(e.merged||e.video).domElement:null});this.__defineGetter__("subscribing",function(){return n});this.__defineGetter__("isWebRTC",function(){return!0})}else OT.handleJsException("Subscriber must be passed a session option",
2E3,{session:k,target:this})}})(window);
(function(){OT.SessionInfo=function(d){var b=null;this.sessionStatus=this.partnerId=this.sessionId=null;this.p2pEnabled=!1;this.iceServers=this.messagingServer=null;OT.log("SessionInfo Response:");OT.log(d);d&&(d.documentElement&&null!==d.documentElement.firstElementChild)&&(b=d.documentElement.firstElementChild);d=b.firstElementChild;do switch(d.localName){case "session_id":this.sessionId=d.textContent;break;case "partner_id":this.partnerId=d.textContent;break;case "session_status":this.sessionStatus=
d.textContent;break;case "messaging_server_url":this.messagingServer=d.textContent;break;case "ice_servers":this.iceServers=[];for(var b=d.childNodes,a,c,e=0,f=b.length;e<f;++e)"ice_server"===b[e].localName&&(c=b[e].attributes,a={url:c.getNamedItem("url").nodeValue},c.getNamedItem("credential")&&c.getNamedItem("credential").nodeValue.length&&(a.credential=c.getNamedItem("credential").nodeValue),this.iceServers.push(a));break;case "properties":if(b=d.firstElementChild){do if("p2p"===b.localName&&null!==
b.firstElementChild){this.p2pEnabled="enabled"===b.firstElementChild.textContent;break}while(b=b.nextElementSibling)}}while(d=d.nextElementSibling)};OT.SessionInfo.get=function(d,b,a){var c=OT.properties.apiURL+"/session/"+d.id+"?extended=true",e=OT.$.now();d.logEvent("getSessionInfo","Attempt","api_url",OT.properties.apiURL);OT.$.getXML(c,{headers:{"X-TB-TOKEN-AUTH":d.token,"X-TB-VERSION":1},success:function(c){d.logEvent("Instrumentation",null,"gsi",OT.$.now()-e);var f=parseErrorFromXMLDocument(c);
!1===f?onGetResponseCallback(d,b,c):onGetErrorCallback(d,a,f)},error:function(b){onGetErrorCallback(d,a,parseErrorFromXMLDocument(b.target.responseXML))}})};var f={};f["404"]=OT.ExceptionCodes.INVALID_SESSION_ID;f["403"]=OT.ExceptionCodes.AUTHENTICATION_ERROR;parseErrorFromXMLDocument=function(d){if(d&&d.documentElement&&null!==d.documentElement.firstElementChild){var d=d.evaluate("//error",d.documentElement,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),b=d.snapshotLength;if(0===b)return!1;for(;0<
b;)return d=d.snapshotItem(0),{code:d.getAttribute("code"),message:d.firstElementChild.getAttribute("message")}}return{code:null,message:"Unknown error: getSessionInfo XML response was badly formed"}};onGetResponseCallback=function(d,b,a){d.logEvent("getSessionInfo","Success","api_url",OT.properties.apiURL);b(new OT.SessionInfo(a))};onGetErrorCallback=function(d,b,a){TB.handleJsException("TB.SessionInfoError :: Unable to get session info "+a.message,f[a.code],{session:d});d.logEvent("getSessionInfo",
"Failure","errorMessage","TB.SessionInfoError :: Unable to get session info "+a.message);b(a,d)}})(window);(function(){OT.Capabilities=function(f){this.publish=OT._.contains(f,"publish")?1:0;this.subscribe=OT._.contains(f,"subscribe")?1:0;this.forceUnpublish=OT._.contains(f,"forceunpublish")?1:0;this.forceDisconnect=OT._.contains(f,"forcedisconnect")?1:0;this.supportsWebRTC=OT.$.supportsWebRTC()?1:0}})(window);
(function(){OT.Session=function(f){function d(a){for(var b in i){var c=i[b];if(a===c.streamId)return c}return null}function b(a){return!a.connection||!j[a.connection.connectionId]?(OT.warn("Received a stream for a connection that doesn't exist"),OT.debug(a),!1):!0}function a(a){n[a.id]=a}if(OT.checkSystemRequirements()){var c=!1,e=!1,h,j={},i={},k={},n={},m,o,q,p={},t=uuid(),u={},s=new OT.Analytics;OT.$.eventing(this);var z=function(d){c=!0;e=!1;h=d.connectionId;p=new OT.Capabilities(d.permissions);
d.connections.forEach(function(a){j[a.connectionId]=a});d.streams=OT._.filter(d.streams,function(a){return b(a)});d.streams.forEach(a);this.dispatchEvent(new OT.SessionConnectEvent(OT.Event.names.SESSION_CONNECTED,d.connections,d.streams,d.archives))},A=function(a){e=c=!1;OT.error(a.reason);this.trigger("sessionConnectFailed",a.reason);switch(a.code){case 409:TB.handleJsException("TB.SessionConnectionFailed :: The P2P session already has two participants.",OT.ExceptionCodes.CONNECT_REJECTED,{session:this});
break;case 410:TB.handleJsException("TB.SessionConnectionFailed :: The session already has four participants.",OT.ExceptionCodes.CONNECT_REJECTED,{session:this});break;default:TB.handleJsException("TB.SessionConnectionFailed :: The session failed to connect.",OT.ExceptionCodes.CONNECT_FAILED,{session:this})}},x=function(a,b){TB.handleJsException(a,b,{session:this})},g=function(a){var b=new OT.SessionDisconnectEvent("sessionDisconnected",a.reason);H.call(this);G.call(this);this.dispatchEvent(b,OT._.bind(function(){if(!b.isDefaultPrevented()){for(var a in i)I(i[a]);
i={};u={};for(var c in k)k[c].destroy();k={}}},this))},r=function(a){j[a.connection.connectionId]=a.connection;a.connections=[a.connection];delete a.connection;this.dispatchEvent(new OT.ConnectionEvent(OT.Event.names.CONNECTION_CREATED,a.connections))},y=function(a){h!==a.connection.connectionId&&delete j[a.connection.connectionId];for(var b in i)i[b].cleanupSubscriber(a.connection.connectionId);a.connections=[a.connection];delete a.connection;this.dispatchEvent(new OT.ConnectionEvent(OT.Event.names.CONNECTION_DESTROYED,
a.connections,a.reason))},C=function(b){OT.debug(b.streams);if(0!==b.streams.length){b.streams.forEach(a);var c;b.streams.forEach(function(a){a.publisherId?(c=i[a.publisherId],delete a.publisherId):c=this.getPublisherForStream(a.id);c&&(c.stream=a)})}},B=function(c){c.streams=OT._.filter(c.streams,b);OT.debug(c.streams);0<c.streams.length&&(c.streams.forEach(a),c.streams.forEach(function(a){(a=d(a.id))&&a._.publishedToSessionHandler()}),this.dispatchEvent(new OT.StreamEvent(OT.Event.names.STREAM_CREATED,
c.streams,c.reason)))},w=function(a){OT.debug(a);var b={orientation:"videoDimensions",hasAudio:"hasAudio",hasVideo:"hasVideo"},c=a.key.split("/"),d=n[a.streamId],e=a.value,c=0<c.length?c[c.length-1]:null;if(!c||!b[c])OT.warn("Unknown stream property was modified.");else{var b=b[c],f=n[a.streamId],g=f[b];f.update(b,a.value);"orientation"===c&&((c=k[a.streamId])&&c.streamOrientationDidChange(a.value.width,a.value.height,a.value.videoOrientation),e={width:e.width,height:e.height});this.dispatchEvent(new OT.StreamPropertyChangedEvent(OT.Event.names.STREAM_PROPERTY_CHANGED,
d,b,g,e))}},E=function(a){if(!(0>=a.streams.length)){a.streams=OT._.filter(a.streams,function(a){return b(a)});var c=new OT.StreamEvent("streamDestroyed",a.streams,a.reason);this.dispatchEvent(c,OT._.bind(function(){var b=!c.isDefaultPrevented();a.streams.forEach(function(a){var c=d(a.id);c&&(c.disconnect(),b&&I(c),delete i[c.guid]);for(var e in k)e===a.id&&(c=k[e],c.disconnect(),b&&this.unsubscribe(c),delete k[e]);delete n[a.id]},this)},this))}},F=function(a){OT.log("jsepMessageHandler: "+JSON.stringify(a));
j[a.fromAddress]||(OT.warn("OT.Session.onMessage: Received peerConnectionData from an unknown connection."),j[a.fromAddress]=new OT.Connection(a.fromAddress,new Date,null,{supportsWebRTC:!0}));if(a.hasOwnProperty("streamId")){var b=null;(b=a.type==OT.WebSocketMessageType.JSEP_SUBSCRIBE||a.type==OT.WebSocketMessageType.JSEP_UNSUBSCRIBE?d(a.streamId,!0):d(a.streamId,!0)||k[a.streamId])?b.processMessage(a.type,j[a.fromAddress],a):OT.warn("OT.Session.onMessage: Received peerConnectionData for an unknown publisher.")}},
J=function(a){var b=j[a.fromAddress]||new OT.Connection(a.fromAddress,OT.$.now(),null,{}),c=a.messagePayload.data?JSON.parse(a.messagePayload.data):null,b=new OT.SignalEvent(a.messagePayload.type,c,b);b.target=this;this.trigger(OT.Event.names.SIGNAL,b);a.messagePayload.type&&this.dispatchEvent(b)},H=function(){h=o=m=null;c=!1;p=null;j={};n={}},G=function(){for(var a in i)i[a].disconnect();for(var b in k)k[b].disconnect()},I=function(a){u[a.guid]&&(a.off("destroyed",u[a.guid]),delete u[a.guid]);a.destroy()},
K=function(a){u[a.guid]=OT._.bind(function(){this.unpublish(a)},this);a.on("destroyed",u[a.guid])},v=function(){TB.log("connectToMessenger");this.properties={requireConnectionObjects:!0};var a=function(a){return function(b){return function(){return b.apply(a,arguments)}}}(this);q=(new OT.Messenger(this.sessionInfo.messagingServer,new OT.SessionMessageWrangler(this))).on({SessionConnected:a(z),SessionConnectFailed:a(A),ConnectionClosed:a(g),ConnectionCreated:a(r),ConnectionDestroyed:a(y),StreamRegistered:a(C),
StreamCreated:a(B),StreamModified:a(w),StreamDestroyed:a(E),JSEPMessageReceived:a(F),SignalReceived:a(J),exception:a(x)});q.connect(f,o,{requireConnectionObjects:this.properties.requireConnectionObjects,p2pEnabled:this.sessionInfo.p2pEnabled,widgetId:t,partnerId:m})},L=function(){e&&OT.SessionInfo.get(this,OT._.bind(M,this),function(){e=!1})},M=function(a){e&&(this.sessionInfo=a,this.sessionInfo.partnerId&&this.sessionInfo.partnerId!=m?(m=this.sessionInfo.partnerId,TB.handleJsException("Authentication Error: The apiKey passed into the session.connect method does not match the apiKey in the token or session you are trying to connect to.",
OT.ExceptionCodes.AUTHENTICATION_ERROR,{session:this})):v.call(this))};this.logEvent=function(a,b,c,d){s.logEvent({action:a,variation:b,payload_type:c,payload:d,session_id:f,partner_id:m,widget_id:t,widget_type:"Controller"})};this.connect=function(a,b){c?OT.warn("OT.Session: Cannot connect, already connected."):e?OT.warn("OT.Session: Cannot connect, already connecting."):(e=!0,H.call(this),m=a.toString(),0===OT.APIKEY.length&&(OT.APIKEY=m),o=b,L.call(this))};this.disconnect=function(){e=!1;q&&(q.disconnect(),
q=null)};this.publish=function(a,b){var d;if(!c)throw s.logError(1010,"tb.exception","We need to be connected before you can publish",null,{action:"publish",variation:"Failure",payload_type:"reason",payload:"We need to be connected before you can publish",session_id:f,partner_id:m,widgetId:t,widget_type:"Controller"}),d="We need to be connected before you can publish",OT.error(d),Error(d);if(1!==p.publish)return s.logEvent({action:"publish",variation:"Failure",payload_type:"reason",payload:"This token does not allow publishing. The role must be at least `publisher` to enable this functionality",
session_id:f,partner_id:m,widgetId:t,widget_type:"Controller"}),TB.handleJsException("This token does not allow publishing. The role must be at least `publisher` to enable this functionality",OT.ExceptionCodes.UNABLE_TO_PUBLISH,{session:this}),null;if(!a||"string"===typeof a)a=OT.initPublisher(this.apiKey,a,b);else if(a instanceof OT.Publisher||a instanceof OT.flash.Publisher)"session"in a&&(a.session&&"sessionId"in a.session)&&(a.session.sessionId===this.sessionId?OT.warn("Cannot publish "+a.guid+
" again to "+this.sessionId+". Please call session.unpublish(publisher) first."):OT.warn("Cannot publish "+a.guid+" publisher already attached to "+a.session.sessionId+". Please call session.unpublish(publisher) first."));else throw d="Session.publish :: First parameter passed in is neither a string nor an instance of the Publisher",OT.error(d),Error(d);i[a.guid]=a;a._.publishToSession(this);K.call(this,a);return a};this.unpublish=function(a){a?a._.unpublishFromSession(this):OT.error("OT.Session.unpublish: publisher parameter missing.")};
this.modifyStream=function(a,b,c){(!a||!b||!c)&&OT.error("OT.Session.modifyStream: must provide streamId, key and value to modify a stream property.");q.sendMessage(OT.WebSocketMessage.modifyStream(a,b,c))};this.subscribe=function(a,b,c){if(!this.connection||!this.connection.connectionId)throw a="Session.subscribe :: Connection required to subscribe",OT.error(a),Error(a);if(!a)throw a="Session.subscribe :: stream cannot be null",OT.error(a),Error(a);if(!a.hasOwnProperty("streamId"))throw a="Session.subscribe :: invalid stream object",
OT.error(a),Error(a);b=new OT.Subscriber(b,OT._.extend(c||{},{session:this}));k[a.streamId]=b;b.subscribe(a);return b};this.unsubscribe=function(a){if(!a)throw OT.error("OT.Session.unsubscribe: subscriber cannot be null"),Error("OT.Session.unsubscribe: subscriber cannot be null");if(!a.stream)return OT.warn("OT.Session.unsubscribe:: tried to unsubscribe a subscriber that had no stream"),!1;OT.debug("OT.Session.unsubscribe: subscriber "+a.id);delete k[a.stream.id];a.destroy();return!0};this.getSubscribersForStream=
function(a){return[k[a.id]]};this.getPublisherForStream=function(a){if("string"!=typeof a)if("object"==typeof a&&a&&a.hasOwnProperty("id"))a=a.id;else throw errorMsg="Session.getPublisherForStream :: Invalid stream type",OT.error(errorMsg),Error(errorMsg);return d(a)};this.sendMessage=function(){return q.sendMessage.apply(q,arguments)};this.signal=function(a){q.signal(a)};this.sendJSEPMessage=function(a,b,c){q&&q.connectionId?q.sendMessage(OT.WebSocketMessage.jsepMessage(q.connectionId,a.connectionId,
b,c)):OT.warn("Session.sendJSEPMessage :: Tried to send a message without a _messenger")};this.forceDisconnect=function(a){1===p.forceDisconnect?q.sendMessage(OT.WebSocketMessage.forceDisconnect("string"===typeof a?a:a.id)):TB.handleJsException("This token does not allow forceDisconnect. The role must be at least `moderator` to enable this functionality",OT.ExceptionCodes.UNABLE_TO_FORCE_DISCONNECT,{session:this})};this.forceUnpublish=function(a){1===p.forceUnpublish?q.sendMessage(OT.WebSocketMessage.forceUnpublish("string"===
typeof a?a:a.id)):TB.handleJsException("This token does not allow forceUnpublish. The role must be at least `moderator` to enable this functionality",OT.ExceptionCodes.UNABLE_TO_FORCE_UNPUBLISH,{session:this})};this.getStateManager=function(){OT.warn("Fixme: Have not implemented session.getStateManager")};this.__defineGetter__("apiKey",function(){return m});this.__defineGetter__("token",function(){return o});this.__defineGetter__("connected",function(){return c});this.__defineGetter__("connection",
function(){return j[h]});this.__defineSetter__("connection",function(a){a.hasOwnProperty("connectionId")&&(h=a.connectionId,j[h]=a)});this.__defineGetter__("capabilities",function(){return p});this.__defineGetter__("sessionId",function(){return f});this.__defineGetter__("id",function(){return f});this.__defineGetter__("connections",function(){return j});this.__defineGetter__("publishers",function(){return i})}else OT.upgradeSystemRequirements()}})(window);
(function(){OT.SessionMessageWrangler=function(f){var d=function(a){return new OT.Connection(a.connectionId,a.creationTime,a.data,{supportsWebRTC:a.supportsWebRTC})},b=function(a){return Object.keys(a).map(function(b){return d(a[b])})},a=function(a,b){var d=[],j;for(j in a)if(a.hasOwnProperty(j)){var i;i=a[j];var k=OT.Stream,n=i.streamId,m=void 0;a:if(f.connections[i.connection.connectionId])m=f.connections[i.connection.connectionId];else{if(b)for(var m=0,o=b.length;m<o;++m)if(i.connection.connectionId===
b[m].id){m=b[m];break a}m=null}k=new k(n,m,i.name,i.streamData,i.type,i.creationTime,i.hasAudio,i.hasVideo,i.orientation?i.orientation:{videoOrientation:OT.VideoOrientation.ROTATED_NORMAL,width:640,height:480},f.id,i.peerId,i.quality,i.orientation?i.orientation.width:640,i.orientation?i.orientation.height:480);i.publisherId&&(k.publisherId=i.publisherId);(i=k)&&d.push(i)}return d};this.wrangle=function(c){if(c.sessionState){if(c.sessionState.CONNECTIONS&&(c.connections=b(c.sessionState.CONNECTIONS)),
c.sessionState.STREAMS)c.streams=a(c.sessionState.STREAMS,c.connections)}else if(c.streams&&(c.streams=a(c.streams,c.connections)),c.connection)c.connection=d(c.connection);return c}}})(window);(function(){OT.onLoad(function(){var f=document.createElement("link");f.type="text/css";f.media="screen";f.rel="stylesheet";f.href=OT.properties.cssURL;(document.head||document.getElementsByTagName("head")[0]).appendChild(f)})})(window);